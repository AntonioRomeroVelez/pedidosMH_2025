import{r as $,u as D}from"./xlsx-hAyDQTdp.js";import{a as d}from"./alertify-DPht8m50.js";import{_ as L,r as b,b as c,d as s,n as M,e as t,j as f,h as V,k as R,a as w,F as _,i as A,m as B,f as k,t as e,p as H}from"./index-B-OBbXgI.js";import{L as T}from"./LoadingComponent-CHeAAwks.js";const G={class:"cargar-excel",style:{"margin-top":"90px"}},O={key:0},z={key:1},J={key:0,class:"mt-3"},U={key:1,class:"table-responsive mt-4"},q={class:"table table-bordered table-sm formato-tabla"},K={__name:"CargarExcel",setup(Q){const h=b(!1),v=b([]),i=b([]),x=B(),E=P=>{h.value=!0;const o=P.target.files[0];if(!o){h.value=!1;return}const m=new FileReader;m.onload=a=>{try{const u=new Uint8Array(a.target.result),y=$(u,{type:"array"});i.value=[];let N=[];y.SheetNames.forEach((g,j)=>{const S=y.Sheets[g];D.sheet_to_json(S).forEach((r,p)=>{const n={ID:`id-${p}-${r.NombreProducto.split(" ")[0]}-${Math.random().toString(36).substr(2,5)}`,NombreProducto:r.NombreProducto??"",Presentacion:r.Presentacion??"",PrincipioActivo:r.PrincipioActivo??"",PrecioFarmacia:parseFloat(r.PrecioFarmacia??""),PVP:parseFloat(r.PVP??""),Promocion:r.Promocion??"",Descuento:parseInt(r.Descuento??0),Marca:r.Marca??"",IVA:parseInt(r.IVA??0)},l=[];n.NombreProducto||l.push("Nombre vac√≠o"),n.Presentacion||l.push("Presentaci√≥n vac√≠a"),n.PrincipioActivo||l.push("Principio activo vac√≠o"),isNaN(n.PrecioFarmacia)&&l.push("Precio farmacia inv√°lido"),isNaN(n.PVP)&&l.push("PVP inv√°lido"),n.Marca||l.push("Marca vac√≠a"),isNaN(n.IVA)&&l.push("IVA inv√°lido"),l.length>0&&(i.value.push({hoja:g,fila:p+2,errores:l,id:`${j}${p}`}),console.log(`Hoja: ${g}, Fila ${p+2}`,r)),N.push(n)})}),v.value=N,i.value.length>0?d.error("‚ùå Hay errores en el archivo. Revisa las filas marcadas."):d.success("‚úÖ Archivo cargado correctamente")}catch(u){d.error("‚ùå Error al procesar el archivo."),console.error("Error al leer Excel:",u)}finally{h.value=!1}},m.readAsArrayBuffer(o)},I=P=>{const o=v.value[P];return i.value.some(m=>m.id===o.ID)},C=()=>{if(i.value.length>0){d.error("‚ùå No se puede guardar. Corrige los errores primero.");return}localStorage.removeItem("ListaProductos"),localStorage.setItem("ListaProductos",JSON.stringify(v.value)),d.success("‚úÖ Productos guardados en memoria"),setTimeout(()=>{x.push("/Productos")},1e3)},F=()=>{d.confirm("‚ö†Ô∏è Confirmaci√≥n","¬øEst√°s seguro de eliminar todos los productos cargados?",()=>{localStorage.removeItem("ListaProductos"),d.success("‚úÖ Archivos eliminados")},()=>{d.error("‚ùå Operaci√≥n cancelada")})};return(P,o)=>{const m=w("RouterLink");return s(),c("div",G,[o[4]||(o[4]=M('<h2 data-v-d0636cc7>üì• Cargar productos desde Excel</h2><p data-v-d0636cc7>üìù El archivo debe tener las siguientes columnas:</p><div class="table-responsive" data-v-d0636cc7><table class="table table-bordered formato-tabla" data-v-d0636cc7><thead data-v-d0636cc7><tr data-v-d0636cc7><th data-v-d0636cc7>NombreProducto</th><th data-v-d0636cc7>Presentacion</th><th data-v-d0636cc7>PrincipioActivo</th><th data-v-d0636cc7>PrecioFarmacia</th><th data-v-d0636cc7>PVP</th><th data-v-d0636cc7>Promocion</th><th data-v-d0636cc7>Descuento</th><th data-v-d0636cc7>Marca</th><th data-v-d0636cc7>IVA</th></tr></thead><tbody data-v-d0636cc7><tr data-v-d0636cc7><td data-v-d0636cc7>Paracetamol 500mg</td><td data-v-d0636cc7>Caja x 10</td><td data-v-d0636cc7>Paracetamol</td><td data-v-d0636cc7>1.50</td><td data-v-d0636cc7>2.00</td><td data-v-d0636cc7>2x1</td><td data-v-d0636cc7>10</td><td data-v-d0636cc7>Genfar</td><td data-v-d0636cc7>15</td></tr></tbody></table></div>',3)),t("input",{type:"file",onChange:E,accept:".xlsx, .xls",class:"form-control my-3"},null,32),t("div",null,[v.value.length?(s(),c("button",{key:0,onClick:C,class:"btn btn-success m-5"}," Guardar productos en memoria ")):f("",!0),t("button",{onClick:F,class:"btn btn-danger m-1"}," Eliminar productos registrados "),V(m,{class:"btn btn-success px-2 sm",to:"/Productos"},{default:R(()=>[...o[0]||(o[0]=[k(" Atr√°s ",-1)])]),_:1})]),h.value?(s(),c("div",O,[V(T)])):(s(),c("div",z,[i.value.length?(s(),c("div",J,[o[1]||(o[1]=t("h5",{class:"text-danger"},"‚ùå Errores detectados:",-1)),t("ul",null,[(s(!0),c(_,null,A(i.value,a=>(s(),c("li",{key:`${a.hoja}-${a.fila}`},[t("strong",null,"Hoja "+e(a.hoja)+", Fila "+e(a.fila)+":",1),k(" "+e(a.errores.join(", ")),1)]))),128))])])):f("",!0),v.value.length?(s(),c("div",U,[o[3]||(o[3]=t("h4",null,"üëÄ Vista previa de productos cargados",-1)),t("table",q,[o[2]||(o[2]=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"NombreProducto"),t("th",null,"Presentacion"),t("th",null,"PrincipioActivo"),t("th",null,"PrecioFarmacia"),t("th",null,"PVP"),t("th",null,"Promocion"),t("th",null,"Descuento"),t("th",null,"Marca"),t("th",null,"IVA")])],-1)),t("tbody",null,[(s(!0),c(_,null,A(v.value,(a,u)=>(s(),c("tr",{key:u,class:H({"table-danger":I(u)})},[t("td",null,e(u+1),1),t("td",null,e(a.NombreProducto),1),t("td",null,e(a.Presentacion),1),t("td",null,e(a.PrincipioActivo),1),t("td",null,e(a.PrecioFarmacia),1),t("td",null,e(a.PVP),1),t("td",null,e(a.Promocion),1),t("td",null,e(a.Descuento),1),t("td",null,e(a.Marca),1),t("td",null,e(a.IVA),1)],2))),128))])])])):f("",!0)]))])}}},at=L(K,[["__scopeId","data-v-d0636cc7"]]);export{at as default};
