import{r as C,u as S}from"./xlsx-hAyDQTdp.js";import{a as n}from"./alertify-DPht8m50.js";import{_ as D,r as g,b as s,d as l,m as $,e as a,j as f,g as M,F as _,i as A,l as L,f as B,t as o,n as w}from"./index-CYmMZlTH.js";import{L as R}from"./LoadingComponent-ddhaE7fj.js";const T={class:"cargar-excel"},G={key:0},H={key:1},O={key:0,class:"mt-3"},z={key:1,class:"table-responsive mt-4"},J={class:"table table-bordered table-sm formato-tabla"},U={__name:"CargarExcel",setup(q){const m=g(!1),u=g([]),i=g([]),E=L(),I=h=>{m.value=!0;const e=h.target.files[0];if(!e){m.value=!1;return}const t=new FileReader;t.onload=v=>{try{const P=new Uint8Array(v.target.result),y=C(P,{type:"array"});i.value=[];let V=[];y.SheetNames.forEach((p,N)=>{const x=y.Sheets[p];S.sheet_to_json(x).forEach((r,b)=>{const c={ID:`id-${N}${b}`,NombreProducto:r.NombreProducto??"",Presentacion:r.Presentacion??"",PrincipioActivo:r.PrincipioActivo??"",PrecioFarmacia:parseFloat(r.PrecioFarmacia??""),PVP:parseFloat(r.PVP??""),Promocion:r.Promocion??"",Descuento:parseInt(r.Descuento??0),Marca:r.Marca??"",IVA:parseInt(r.IVA??0)},d=[];c.NombreProducto||d.push("Nombre vac√≠o"),c.Presentacion||d.push("Presentaci√≥n vac√≠a"),c.PrincipioActivo||d.push("Principio activo vac√≠o"),isNaN(c.PrecioFarmacia)&&d.push("Precio farmacia inv√°lido"),isNaN(c.PVP)&&d.push("PVP inv√°lido"),c.Marca||d.push("Marca vac√≠a"),isNaN(c.IVA)&&d.push("IVA inv√°lido"),d.length>0&&(i.value.push({hoja:p,fila:b+2,errores:d,id:`${N}${b}`}),console.log(`Hoja: ${p}, Fila ${b+2}`,r)),V.push(c)})}),u.value=V,i.value.length>0?n.error("‚ùå Hay errores en el archivo. Revisa las filas marcadas."):n.success("‚úÖ Archivo cargado correctamente")}catch(P){n.error("‚ùå Error al procesar el archivo."),console.error("Error al leer Excel:",P)}finally{m.value=!1}},t.readAsArrayBuffer(e)},F=h=>{const e=u.value[h];return i.value.some(t=>t.id===e.ID)},k=()=>{if(i.value.length>0){n.error("‚ùå No se puede guardar. Corrige los errores primero.");return}localStorage.removeItem("ListaProductos"),localStorage.setItem("ListaProductos",JSON.stringify(u.value)),n.success("‚úÖ Productos guardados en memoria"),setTimeout(()=>{E.push("/Productos")},1e3)},j=()=>{n.confirm("‚ö†Ô∏è Confirmaci√≥n","¬øEst√°s seguro de eliminar todos los productos cargados?",()=>{localStorage.removeItem("ListaProductos"),n.success("‚úÖ Archivos eliminados")},()=>{n.error("‚ùå Operaci√≥n cancelada")})};return(h,e)=>(l(),s("div",T,[e[3]||(e[3]=$('<h2 data-v-094b7d89>üì• Cargar productos desde Excel</h2><p data-v-094b7d89>üìù El archivo debe tener las siguientes columnas:</p><div class="table-responsive" data-v-094b7d89><table class="table table-bordered formato-tabla" data-v-094b7d89><thead data-v-094b7d89><tr data-v-094b7d89><th data-v-094b7d89>NombreProducto</th><th data-v-094b7d89>Presentacion</th><th data-v-094b7d89>PrincipioActivo</th><th data-v-094b7d89>PrecioFarmacia</th><th data-v-094b7d89>PVP</th><th data-v-094b7d89>Promocion</th><th data-v-094b7d89>Descuento</th><th data-v-094b7d89>Marca</th><th data-v-094b7d89>IVA</th></tr></thead><tbody data-v-094b7d89><tr data-v-094b7d89><td data-v-094b7d89>Paracetamol 500mg</td><td data-v-094b7d89>Caja x 10</td><td data-v-094b7d89>Paracetamol</td><td data-v-094b7d89>1.50</td><td data-v-094b7d89>2.00</td><td data-v-094b7d89>2x1</td><td data-v-094b7d89>10</td><td data-v-094b7d89>Genfar</td><td data-v-094b7d89>15</td></tr></tbody></table></div>',3)),a("input",{type:"file",onChange:I,accept:".xlsx, .xls",class:"form-control my-3"},null,32),a("div",null,[u.value.length?(l(),s("button",{key:0,onClick:k,class:"btn btn-success m-5"}," Guardar productos en memoria ")):f("",!0),a("button",{onClick:j,class:"btn btn-danger m-1"}," Eliminar productos registrados ")]),m.value?(l(),s("div",G,[M(R)])):(l(),s("div",H,[i.value.length?(l(),s("div",O,[e[0]||(e[0]=a("h5",{class:"text-danger"},"‚ùå Errores detectados:",-1)),a("ul",null,[(l(!0),s(_,null,A(i.value,t=>(l(),s("li",{key:`${t.hoja}-${t.fila}`},[a("strong",null,"Hoja "+o(t.hoja)+", Fila "+o(t.fila)+":",1),B(" "+o(t.errores.join(", ")),1)]))),128))])])):f("",!0),u.value.length?(l(),s("div",z,[e[2]||(e[2]=a("h4",null,"üëÄ Vista previa de productos cargados",-1)),a("table",J,[e[1]||(e[1]=a("thead",null,[a("tr",null,[a("th",null,"#"),a("th",null,"NombreProducto"),a("th",null,"Presentacion"),a("th",null,"PrincipioActivo"),a("th",null,"PrecioFarmacia"),a("th",null,"PVP"),a("th",null,"Promocion"),a("th",null,"Descuento"),a("th",null,"Marca"),a("th",null,"IVA")])],-1)),a("tbody",null,[(l(!0),s(_,null,A(u.value,(t,v)=>(l(),s("tr",{key:v,class:w({"table-danger":F(v)})},[a("td",null,o(v+1),1),a("td",null,o(t.NombreProducto),1),a("td",null,o(t.Presentacion),1),a("td",null,o(t.PrincipioActivo),1),a("td",null,o(t.PrecioFarmacia),1),a("td",null,o(t.PVP),1),a("td",null,o(t.Promocion),1),a("td",null,o(t.Descuento),1),a("td",null,o(t.Marca),1),a("td",null,o(t.IVA),1)],2))),128))])])])):f("",!0)]))]))}},Z=D(U,[["__scopeId","data-v-094b7d89"]]);export{Z as default};
