import{r as S,u as $}from"./xlsx-hAyDQTdp.js";import{_ as w,m as D,r as f,n as M,a as L,b as s,d as l,q as R,e as a,j as P,f as y,t as o,h as V,k as B,F as _,i as A,s as T}from"./index-CcTAiHa-.js";import{L as H}from"./LoadingComponent-CkjYCNxu.js";const G={class:"cargar-excel container",style:{"margin-top":"60px"}},q={class:"mb-4"},z={class:"input-group"},J={key:0,class:"form-text text-success mt-2"},O={key:0},U={key:1},K={key:0,class:"mt-3"},Q={key:1,class:"table-responsive mt-4"},W={class:"table table-bordered table-sm formato-tabla"},X={__name:"CargarExcel",setup(Y){const m=D(),h=f(!1),u=f([]),c=f([]),I=M(),k=v=>{h.value=!0;const t=v.target.files[0];if(!t){h.value=!1;return}const b=new FileReader;b.onload=e=>{try{const i=new Uint8Array(e.target.result),x=S(i,{type:"array"});c.value=[];let N=[];x.SheetNames.forEach((g,F)=>{const j=x.Sheets[g];$.sheet_to_json(j).forEach((r,p)=>{const d={ID:`id-${p}-${r.NombreProducto.split(" ")[0]}-${Math.random().toString(36).substr(2,5)}`,NombreProducto:r.NombreProducto??"",Presentacion:r.Presentacion??"",PrincipioActivo:r.PrincipioActivo??"",PrecioFarmacia:parseFloat(r.PrecioFarmacia??""),PVP:parseFloat(r.PVP??""),Promocion:r.Promocion??"",Descuento:parseInt(r.Descuento??0),Marca:r.Marca??"",IVA:parseInt(r.IVA??0)},n=[];d.NombreProducto||n.push("Nombre vac√≠o"),d.Presentacion||n.push("Presentaci√≥n vac√≠a"),d.PrincipioActivo||n.push("Principio activo vac√≠o"),isNaN(d.PrecioFarmacia)&&n.push("Precio farmacia inv√°lido"),isNaN(d.PVP)&&n.push("PVP inv√°lido"),d.Marca||n.push("Marca vac√≠a"),isNaN(d.IVA)&&n.push("IVA inv√°lido"),n.length>0&&(c.value.push({hoja:g,fila:p+2,errores:n,id:`${F}${p}`}),console.log(`Hoja: ${g}, Fila ${p+2}`,r)),N.push(d)})}),u.value=N,c.value.length>0?m.error("‚ùå Hay errores en el archivo. Revisa las filas marcadas."):m.success("‚úÖ Archivo cargado correctamente")}catch(i){m.error("‚ùå Error al procesar el archivo."),console.error("Error al leer Excel:",i)}finally{h.value=!1}},b.readAsArrayBuffer(t)},E=v=>{const t=u.value[v];return c.value.some(b=>b.id===t.ID)},C=()=>{if(c.value.length>0){m.error("‚ùå No se puede guardar. Corrige los errores primero.");return}localStorage.removeItem("ListaProductos"),localStorage.setItem("ListaProductos",JSON.stringify(u.value)),m.success("‚úÖ Productos guardados en memoria"),setTimeout(()=>{I.push("/Productos")},1e3)};return(v,t)=>{const b=L("RouterLink");return l(),s("div",G,[t[6]||(t[6]=R('<h2 data-v-d1709a9b>üì• Cargar productos desde Excel</h2><p data-v-d1709a9b>üìù El archivo debe tener las siguientes columnas:</p><div class="table-responsive container" data-v-d1709a9b><table class="table table-bordered formato-tabla" data-v-d1709a9b><thead data-v-d1709a9b><tr data-v-d1709a9b><th data-v-d1709a9b>NombreProducto</th><th data-v-d1709a9b>Presentacion</th><th data-v-d1709a9b>PrincipioActivo</th><th data-v-d1709a9b>PrecioFarmacia</th><th data-v-d1709a9b>PVP</th><th data-v-d1709a9b>Promocion</th><th data-v-d1709a9b>Descuento</th><th data-v-d1709a9b>Marca</th><th data-v-d1709a9b>IVA</th></tr></thead><tbody data-v-d1709a9b><tr data-v-d1709a9b><td data-v-d1709a9b>Paracetamol 500mg</td><td data-v-d1709a9b>Caja x 10</td><td data-v-d1709a9b>Paracetamol</td><td data-v-d1709a9b>1.50</td><td data-v-d1709a9b>2.00</td><td data-v-d1709a9b>2x1</td><td data-v-d1709a9b>10</td><td data-v-d1709a9b>Genfar</td><td data-v-d1709a9b>15</td></tr></tbody></table></div>',3)),a("div",q,[t[1]||(t[1]=a("label",{for:"excelInput",class:"form-label fw-semibold text-primary"}," üìÑ Cargar archivo Excel ",-1)),a("div",z,[t[0]||(t[0]=a("label",{class:"input-group-text bg-success text-white",for:"excelInput",style:{cursor:"pointer"}},[a("i",{class:"bi bi-arrow-bar-up me-2"}),y(" Subir Excel ")],-1)),a("input",{type:"file",class:"form-control",id:"excelInput",onChange:k,accept:".xlsx, .xls"},null,32)]),v.archivoNombre?(l(),s("div",J," Archivo seleccionado: "+o(v.archivoNombre),1)):P("",!0)]),a("div",null,[u.value.length?(l(),s("button",{key:0,onClick:C,class:"btn btn-success m-5"}," Guardar productos en memoria ")):P("",!0),V(b,{class:"btn btn-warning px-2 sm",to:"/Productos"},{default:B(()=>[...t[2]||(t[2]=[y(" Cancelar ",-1)])]),_:1})]),h.value?(l(),s("div",O,[V(H)])):(l(),s("div",U,[c.value.length?(l(),s("div",K,[t[3]||(t[3]=a("h5",{class:"text-danger"},"‚ùå Errores detectados:",-1)),a("ul",null,[(l(!0),s(_,null,A(c.value,e=>(l(),s("li",{key:`${e.hoja}-${e.fila}`},[a("strong",null,"Hoja "+o(e.hoja)+", Fila "+o(e.fila)+":",1),y(" "+o(e.errores.join(", ")),1)]))),128))])])):P("",!0),u.value.length?(l(),s("div",Q,[t[5]||(t[5]=a("h4",null,"üëÄ Vista previa de productos cargados",-1)),a("table",W,[t[4]||(t[4]=a("thead",null,[a("tr",null,[a("th",null,"#"),a("th",null,"NombreProducto"),a("th",null,"Presentacion"),a("th",null,"PrincipioActivo"),a("th",null,"PrecioFarmacia"),a("th",null,"PVP"),a("th",null,"Promocion"),a("th",null,"Descuento"),a("th",null,"Marca"),a("th",null,"IVA")])],-1)),a("tbody",null,[(l(!0),s(_,null,A(u.value,(e,i)=>(l(),s("tr",{key:i,class:T({"table-danger":E(i)})},[a("td",null,o(i+1),1),a("td",null,o(e.NombreProducto),1),a("td",null,o(e.Presentacion),1),a("td",null,o(e.PrincipioActivo),1),a("td",null,o(e.PrecioFarmacia),1),a("td",null,o(e.PVP),1),a("td",null,o(e.Promocion),1),a("td",null,o(e.Descuento),1),a("td",null,o(e.Marca),1),a("td",null,o(e.IVA),1)],2))),128))])])])):P("",!0)]))])}}},oa=w(X,[["__scopeId","data-v-d1709a9b"]]);export{oa as default};
