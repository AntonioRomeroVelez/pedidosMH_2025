import{r as B,u as L}from"./xlsx-eYdzo_tC.js";import{E as $}from"./exceljs.min-msUC2npy.js";import{F as G}from"./FileSaver.min-Dxqm_i4a.js";import{_ as J,m as U,n as z,r as g,o as H,a as W,b as n,d,q,e,j as b,f as y,t as r,h as F,k as K,F as w,i as V,s as Q}from"./index-CXviXgt1.js";import{L as X}from"./LoadingComponent-DfsIe93f.js";const Y={class:"cargar-excel container",style:{"margin-top":"60px"}},Z={class:"mb-4"},ee={class:"input-group"},te={key:0,class:"form-text text-success mt-2"},oe={key:0},ae={key:1},re={key:0,class:"mt-3"},se={key:1,class:"table-responsive mt-4"},ne={class:"table table-bordered table-sm formato-tabla"},de={__name:"CargarExcel",setup(le){const u=U(),_=z(),f=g(!1),l=g([]),p=g([]),P=g([]),C=g("");H(()=>{const i=localStorage.getItem("ListaProductos");i&&(l.value=JSON.parse(i))});const S=i=>{f.value=!0;const t=i.target.files[0];if(!t){f.value=!1;return}C.value=t.name;const m=new FileReader;m.onload=o=>{try{const s=new Uint8Array(o.target.result),k=B(s,{type:"array"});p.value=[],P.value=[];let A=[];k.SheetNames.forEach((h,j)=>{const T=k.Sheets[h];L.sheet_to_json(T).forEach((a,N)=>{const v={Codigo:a.CODIGO,ID:`id-${N}-${Math.random().toString(36).substr(2,5)}`,NombreProducto:a.NombreProducto??a.NOMBRE??"",Presentacion:a.Presentacion??a.PRESENTACION??"",PrincipioActivo:a.PrincipioActivo??a.PRINCIPIO_ACTIVO??"",PrecioFarmacia:parseFloat(a.PrecioFarmacia??a.P_FARMACIA??"")||0,PVP:parseFloat(a.PVP??"")||0,Promocion:a.Promocion??a.PROMOCION??"",Descuento:parseInt(a.Descuento??a.DESCUENTO??0)||parseFloat(a.Descuento??a.DESCUENTO??0)||0,Marca:a.Marca??a.MARCA??"",IVA:parseInt(a.IVA??0)||0},c=[];v.NombreProducto||c.push("Nombre vac√≠o"),v.Presentacion||c.push("Presentaci√≥n vac√≠a"),v.PrincipioActivo||c.push("Principio activo vac√≠o"),isNaN(v.PrecioFarmacia)&&c.push("Precio farmacia inv√°lido"),isNaN(v.PVP)&&c.push("PVP inv√°lido"),v.Marca||c.push("Marca vac√≠a"),isNaN(v.IVA)&&c.push("IVA inv√°lido"),c.length>0&&p.value.push({hoja:h,fila:N+2,errores:c,id:`${j}${N}`}),A.push(v)})});const I=l.value.length>0?[...l.value]:JSON.parse(localStorage.getItem("ListaProductos")||"[]"),R=new Set(I.map(h=>h.Codigo)),E=[],x=[];A.forEach(h=>{R.has(h.Codigo)?x.push(h):E.push(h)}),l.value=[...I,...E],P.value=x,x.length>0?u.warning(`‚ö†Ô∏è Se detectaron ${x.length} productos repetidos. Puedes exportarlos.`):u.success("‚úÖ Archivo cargado correctamente"),p.value.length>0&&u.error("‚ùå Hay errores en el archivo. Revisa las filas marcadas.")}catch(s){u.error("‚ùå Error al procesar el archivo."),console.error("Error al leer Excel:",s)}finally{f.value=!1}},m.readAsArrayBuffer(t)};async function O(){if(!P.value.length){u.info("No hay productos repetidos para exportar");return}const i=new $.Workbook,t=i.addWorksheet("Productos Repetidos");t.columns=[{header:"CODIGO",key:"Codigo",width:15},{header:"NombreProducto",key:"NombreProducto",width:40},{header:"Presentacion",key:"Presentacion",width:25},{header:"PrincipioActivo",key:"PrincipioActivo",width:30},{header:"PrecioFarmacia",key:"PrecioFarmacia",width:15},{header:"PVP",key:"PVP",width:12},{header:"Promocion",key:"Promocion",width:15},{header:"Descuento",key:"Descuento",width:12},{header:"Marca",key:"Marca",width:20},{header:"IVA",key:"IVA",width:10}],P.value.forEach(s=>t.addRow(s)),t.getRow(1).eachCell(s=>{s.font={bold:!0,color:{argb:"FFFFFFFF"}},s.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFB91D1D"}},s.alignment={vertical:"middle",horizontal:"center"}});const o=await i.xlsx.writeBuffer();G.saveAs(new Blob([o]),"productos_repetidos.xlsx"),u.success("üì¶ Archivo de productos repetidos exportado correctamente")}const D=i=>{const t=l.value[i];return p.value.some(m=>m.id===t.ID)},M=()=>{if(p.value.length>0){u.error("‚ùå No se puede guardar. Corrige los errores primero.");return}localStorage.setItem("ListaProductos",JSON.stringify(l.value)),u.success(`‚úÖ Se guardaron ${l.value.length} productos en memoria (sin borrar los anteriores).`),setTimeout(()=>{_.push("/Productos")},1e3)};return(i,t)=>{const m=W("RouterLink");return d(),n("div",Y,[t[7]||(t[7]=q('<h2 data-v-532e3d17>üì• Cargar productos desde Excel</h2><p data-v-532e3d17>üìù El archivo debe tener las siguientes columnas:</p><div class="table-responsive container" data-v-532e3d17><table class="table table-bordered formato-tabla" data-v-532e3d17><thead data-v-532e3d17><tr data-v-532e3d17><th data-v-532e3d17>CODIGO</th><th data-v-532e3d17>NombreProducto</th><th data-v-532e3d17>Presentacion</th><th data-v-532e3d17>PrincipioActivo</th><th data-v-532e3d17>PrecioFarmacia</th><th data-v-532e3d17>PVP</th><th data-v-532e3d17>Promocion</th><th data-v-532e3d17>Descuento</th><th data-v-532e3d17>Marca</th><th data-v-532e3d17>IVA</th></tr></thead><tbody data-v-532e3d17><tr data-v-532e3d17><td data-v-532e3d17>2343</td><td data-v-532e3d17>Paracetamol 500mg</td><td data-v-532e3d17>Caja x 10</td><td data-v-532e3d17>Paracetamol</td><td data-v-532e3d17>1.50</td><td data-v-532e3d17>2.00</td><td data-v-532e3d17>2x1</td><td data-v-532e3d17>10</td><td data-v-532e3d17>Genfar</td><td data-v-532e3d17>15</td></tr></tbody></table></div>',3)),e("div",Z,[t[1]||(t[1]=e("label",{for:"excelInput",class:"form-label fw-semibold text-primary"}," üìÑ Cargar archivo Excel ",-1)),e("div",ee,[t[0]||(t[0]=e("label",{class:"input-group-text bg-success text-white",for:"excelInput",style:{cursor:"pointer"}},[e("i",{class:"bi bi-arrow-bar-up me-2"}),y(" Subir Excel ")],-1)),e("input",{type:"file",class:"form-control",id:"excelInput",onChange:S,accept:".xlsx, .xls"},null,32)]),C.value?(d(),n("div",te," Archivo seleccionado: "+r(C.value),1)):b("",!0)]),e("div",null,[l.value.length?(d(),n("button",{key:0,onClick:M,class:"btn btn-success m-5"}," Guardar productos en memoria ")):b("",!0),P.value.length?(d(),n("button",{key:1,onClick:O,class:"btn btn-danger mx-2"},[...t[2]||(t[2]=[e("i",{class:"bi bi-file-earmark-excel"},null,-1),y(" Exportar productos repetidos ",-1)])])):b("",!0),F(m,{class:"btn btn-warning px-2 sm",to:"/Productos"},{default:K(()=>[...t[3]||(t[3]=[y(" Cancelar ",-1)])]),_:1})]),f.value?(d(),n("div",oe,[F(X)])):(d(),n("div",ae,[p.value.length?(d(),n("div",re,[t[4]||(t[4]=e("h5",{class:"text-danger"},"‚ùå Errores detectados:",-1)),e("ul",null,[(d(!0),n(w,null,V(p.value,o=>(d(),n("li",{key:`${o.hoja}-${o.fila}`},[e("strong",null,"Hoja "+r(o.hoja)+", Fila "+r(o.fila)+":",1),y(" "+r(o.errores.join(", ")),1)]))),128))])])):b("",!0),l.value.length?(d(),n("div",se,[t[6]||(t[6]=e("h4",null,"üëÄ Vista previa de productos cargados",-1)),e("table",ne,[t[5]||(t[5]=e("thead",null,[e("tr",null,[e("th",null,"Codigo"),e("th",null,"#"),e("th",null,"NombreProducto"),e("th",null,"Presentacion"),e("th",null,"PrincipioActivo"),e("th",null,"PrecioFarmacia"),e("th",null,"PVP"),e("th",null,"Promocion"),e("th",null,"Descuento"),e("th",null,"Marca"),e("th",null,"IVA")])],-1)),e("tbody",null,[(d(!0),n(w,null,V(l.value,(o,s)=>(d(),n("tr",{key:s,class:Q({"table-danger":D(s)})},[e("td",null,r(o.CODIGO),1),e("td",null,r(s+1),1),e("td",null,r(o.NombreProducto),1),e("td",null,r(o.Presentacion),1),e("td",null,r(o.PrincipioActivo),1),e("td",null,r(o.PrecioFarmacia),1),e("td",null,r(o.PVP),1),e("td",null,r(o.Promocion),1),e("td",null,r(o.Descuento),1),e("td",null,r(o.Marca),1),e("td",null,r(o.IVA),1)],2))),128))])])])):b("",!0)]))])}}},me=J(de,[["__scopeId","data-v-532e3d17"]]);export{me as default};
