import{_ as j,m as B,n as U,r as u,o as z,c as G,a as $,b as c,d as n,q as J,e,i as m,k as g,t as a,g as N,j as W,w as q,s as H,F as K,h as Q,x as X}from"./index-BlsfIA4-.js";import{r as Y,u as Z}from"./xlsx-hAyDQTdp.js";import{E as ee}from"./exceljs.min-pZkpFZ_o.js";import{F as te}from"./FileSaver.min-BhSM8yIA.js";import{L as oe}from"./LoadingComponent-BbyFe0rg.js";const ae={class:"cargar-excel"},re={class:"mb-4"},se={class:"input-group"},de={key:0,class:"form-text text-success mt-2"},le={key:0,class:"alert alert-info"},ie={class:"mb-0"},ce={class:"mb-4"},ne={key:1},ue={key:2},pe={key:0,class:"mb-3 text-end"},ve={key:1,class:"vista-previa mt-4"},me={class:"table-responsive shadow-sm rounded-4 border position-relative",style:{"max-height":"70vh","overflow-y":"auto"}},be={class:"table table-hover align-middle text-center table-striped",style:{"min-width":"950px","word-wrap":"break-word","table-layout":"fixed"}},he={class:"text-break"},ge={class:"text-break"},fe={class:"text-break"},xe={class:"text-break"},ye={class:"text-break"},Pe={__name:"CargarExcel",setup(we){const p=B(),E=U(),f=u(!1),r=u([]),A=u([]),v=u([]),k=u(""),I=u(0),x=u(!1),y=u("todos");z(()=>{const s=localStorage.getItem("ListaProductos");s&&(r.value=JSON.parse(s))});const R=G(()=>y.value==="repetidos"?r.value.filter(s=>s.duplicado):y.value==="noRepetidos"?r.value.filter(s=>!s.duplicado):r.value),V=s=>{f.value=!0;const t=s.target.files[0];if(!t){f.value=!1;return}k.value=t.name;const b=new FileReader;b.onload=o=>{try{const l=new Uint8Array(o.target.result),C=Y(l,{type:"array"});A.value=[],v.value=[],x.value=!1;let P=[];C.SheetNames.forEach(d=>{const h=C.Sheets[d];Z.sheet_to_json(h).forEach(F=>{const i={};Object.keys(F).forEach(S=>{const L=S.normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim().toUpperCase();i[L]=F[S]});const M=i.CODIGO?.toString().trim()||"",T={ID:crypto.randomUUID(),Codigo:M,Marca:i.MARCA?.toString().trim()||"",NombreProducto:i.NOMBRE?.toString().trim()||"",Presentacion:i.PRESENTACION?.toString().trim()||"",PrincipioActivo:i.PRINCIPIO_ACTIVO?.toString().trim()||"",PrecioFarmacia:parseFloat((i.P_FARMACIA||"0").toString().replace(",","."))||0,PVP:parseFloat((i.PVP||"0").toString().replace(",","."))||0,Promocion:i.PROMOCION||"",Descuento:parseFloat((i.DESCUENTO||"0").toString())||0,IVA:parseFloat((i.IVA||"0").toString().replace(",","."))||0,duplicado:!1};P.push(T)})});const w=d=>(d||"").toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"").toLowerCase(),_=new Map;P.forEach(d=>{const h=`${w(d.Marca)}|${w(d.NombreProducto)}|${w(d.Presentacion)}|${w(d.PrincipioActivo)}`;_.has(h)?(d.duplicado=!0,_.get(h).duplicado=!0,x.value=!0):_.set(h,d)}),r.value=P,v.value=P.filter(d=>d.duplicado),x.value?p.error("‚ö†Ô∏è Se detectaron productos duplicados en el archivo. Revisa los resaltados en rojo."):p.success("‚úÖ Archivo cargado correctamente, sin duplicados internos.")}catch(l){p.error("‚ùå Error al procesar el archivo."),console.error("Error al leer Excel:",l)}finally{f.value=!1}},b.readAsArrayBuffer(t)},D=()=>{if(x.value){p.error("‚ùå No se puede guardar. Elimina los productos duplicados.");return}localStorage.setItem("ListaProductos",JSON.stringify(r.value)),p.success(`‚úÖ Se guardaron ${r.value.length} productos correctamente.`),setTimeout(()=>{E.push("/Productos")},1e3)};async function O(){if(!v.value.length){p.info("No hay productos repetidos para exportar");return}const s=new ee.Workbook,t=s.addWorksheet("Productos Repetidos");t.columns=[{header:"CODIGO",key:"Codigo",width:15},{header:"Marca",key:"Marca",width:20},{header:"NombreProducto",key:"NombreProducto",width:40},{header:"Presentacion",key:"Presentacion",width:25},{header:"PrincipioActivo",key:"PrincipioActivo",width:30}],v.value.forEach(l=>t.addRow(l)),t.getRow(1).eachCell(l=>{l.font={bold:!0,color:{argb:"FFFFFFFF"}},l.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFB91D1D"}},l.alignment={vertical:"middle",horizontal:"center"}});const o=await s.xlsx.writeBuffer();te.saveAs(new Blob([o]),"productos_repetidos.xlsx"),p.success("üì¶ Archivo de productos repetidos exportado correctamente")}return(s,t)=>{const b=$("RouterLink");return n(),c("div",ae,[t[12]||(t[12]=J('<h2 data-v-bee43cd0>üì• Cargar productos desde Excel</h2><p data-v-bee43cd0>üìù El archivo debe tener las siguientes columnas:</p><div class="table-responsive" data-v-bee43cd0><table class="table table-bordered formato-tabla" data-v-bee43cd0><thead data-v-bee43cd0><tr data-v-bee43cd0><th data-v-bee43cd0>CODIGO</th><th data-v-bee43cd0>Marca</th><th data-v-bee43cd0>Nombre</th><th data-v-bee43cd0>Presentacion</th><th data-v-bee43cd0>Principio_Activo</th><th data-v-bee43cd0>P_Farmacia</th><th data-v-bee43cd0>PVP</th><th data-v-bee43cd0>Promocion</th><th data-v-bee43cd0>Descuento</th><th data-v-bee43cd0>IVA</th></tr></thead><tbody data-v-bee43cd0><tr data-v-bee43cd0><td data-v-bee43cd0>2343</td><td data-v-bee43cd0>Genfar</td><td data-v-bee43cd0>Paracetamol 500mg</td><td data-v-bee43cd0>Caja x 10</td><td data-v-bee43cd0>Paracetamol</td><td data-v-bee43cd0>1.50</td><td data-v-bee43cd0>2.00</td><td data-v-bee43cd0>2x1</td><td data-v-bee43cd0>10</td><td data-v-bee43cd0>15</td></tr></tbody></table></div>',3)),e("div",re,[t[2]||(t[2]=e("label",{for:"excelInput",class:"form-label fw-semibold text-primary"}," üìÑ Cargar archivo Excel ",-1)),e("div",se,[t[1]||(t[1]=e("label",{class:"input-group-text bg-success text-white",for:"excelInput",style:{cursor:"pointer"}},[e("i",{class:"bi bi-arrow-bar-up me-2"}),g(" Subir Excel ")],-1)),e("input",{type:"file",class:"form-control",id:"excelInput",onChange:V,accept:".xlsx, .xls"},null,32)]),k.value?(n(),c("div",de," Archivo seleccionado: "+a(k.value),1)):m("",!0)]),r.value.length||v.value.length?(n(),c("div",le,[t[6]||(t[6]=e("strong",null,"üìä Resumen:",-1)),e("ul",ie,[e("li",null,[t[3]||(t[3]=g(" üü¢ Nuevos productos cargados: ",-1)),e("b",null,a(I.value),1)]),e("li",null,[t[4]||(t[4]=g(" üü° Productos repetidos detectados: ",-1)),e("b",null,a(v.value.length),1)]),e("li",null,[t[5]||(t[5]=g(" üì¶ Total actual en memoria: ",-1)),e("b",null,a(r.value.length),1)])])])):m("",!0),e("div",ce,[r.value.length?(n(),c("button",{key:0,onClick:D,class:"btn btn-success m-2"}," üíæ Guardar productos en memoria ")):m("",!0),v.value.length?(n(),c("button",{key:1,onClick:O,class:"btn btn-danger m-2"}," üì§ Exportar productos repetidos ")):m("",!0),N(b,{class:"btn btn-warning px-2 sm m-2",to:"/Productos"},{default:W(()=>[...t[7]||(t[7]=[g(" Cancelar ",-1)])]),_:1})]),f.value?(n(),c("div",ne,[N(oe)])):(n(),c("div",ue,[r.value.length?(n(),c("div",pe,[t[9]||(t[9]=e("label",{class:"me-2 fw-semibold text-primary"},"üîç Mostrar:",-1)),q(e("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>y.value=o),class:"form-select d-inline w-auto"},[...t[8]||(t[8]=[e("option",{value:"todos"},"Todos",-1),e("option",{value:"repetidos"},"Solo repetidos",-1),e("option",{value:"noRepetidos"},"Solo no repetidos",-1)])],512),[[H,y.value]])])):m("",!0),r.value.length?(n(),c("div",ve,[t[11]||(t[11]=e("h4",{class:"fw-bold text-primary mb-3 text-center text-md-start"}," Vista previa de productos cargados ",-1)),e("div",me,[e("table",be,[t[10]||(t[10]=e("thead",{class:"table-primary sticky-header"},[e("tr",null,[e("th",{scope:"col",style:{"min-width":"140px"}},"Marca"),e("th",{scope:"col",style:{"min-width":"200px"}},"Nombre Producto"),e("th",{scope:"col",style:{"min-width":"140px"}},"Presentaci√≥n"),e("th",{scope:"col",style:{"min-width":"160px"}},"Principio Activo"),e("th",{scope:"col",style:{"min-width":"100px"}},"P. Farmacia"),e("th",{scope:"col",style:{"min-width":"90px"}},"PVP"),e("th",{scope:"col",style:{"min-width":"120px"}},"Promoci√≥n"),e("th",{scope:"col",style:{"min-width":"120px"}},"Descuento"),e("th",{scope:"col",style:{"min-width":"70px"}},"IVA")])],-1)),e("tbody",null,[(n(!0),c(K,null,Q(R.value,(o,l)=>(n(),c("tr",{key:l,class:X({"table-danger":o.duplicado})},[e("td",he,a(o.Marca),1),e("td",ge,a(o.NombreProducto),1),e("td",fe,a(o.Presentacion),1),e("td",xe,a(o.PrincipioActivo),1),e("td",null,a(o.PrecioFarmacia.toFixed(2)),1),e("td",null,a(o.PVP.toFixed(2)),1),e("td",ye,a(o.Promocion),1),e("td",null,a(o.Descuento),1),e("td",null,a(o.IVA),1)],2))),128))])])])])):m("",!0)]))])}}},Ee=j(Pe,[["__scopeId","data-v-bee43cd0"]]);export{Ee as default};
