import{_ as Z,m as tt,r as f,o as et,x as ot,b as u,d as p,e as t,j as E,w as x,v as k,y as U,F as B,i as H,t as d,z as J,f as I,s as at,p as D,A as st}from"./index-BQf7giwL.js";import{E as nt}from"./exceljs.min-QOjBfRpH.js";import{F as q}from"./FileSaver.min-D8H4rPCH.js";import{c as T}from"./utility-BAyQKch2.js";const lt={class:"container px-0"},rt={key:0,class:"row mb-4"},dt={class:"col-md-3"},it={class:"col-md-3"},ct={class:"col-md-3"},ut={class:"col-md-3"},pt={class:"col-md-3"},mt={key:1,class:"mt-4 d-flex justify-content-around flex-wrap gap-4"},bt=["disabled"],vt=["disabled"],ft={key:2,class:"mt-4"},gt={key:0,class:"export-overlay"},ht={key:1,class:"table-container"},xt={class:"table table-bordered table-sm table-striped text-center align-middle tableProductos mx-auto"},yt={"data-label":"Nombre"},_t={"data-label":"Presentaci√≥n"},wt={"data-label":"Principio Activo"},Ct={"data-label":"Precio Farmacia"},Pt={"data-label":"Promoci√≥n"},Ft={"data-label":"Descuento"},Vt={"data-label":"Marca"},Nt={"data-label":"IVA"},Et={"data-label":"Cantidad"},kt=["onUpdate:modelValue","onChange"],Tt={"data-label":"Cantidad a recibir"},At={"data-label":"Acciones"},$t=["onClick"],St={key:2,class:"mobile-cards"},It={class:"card-body"},Dt={class:"d-flex justify-content-between align-items-start mb-2"},Rt={class:"product-info"},zt={class:"card-title mb-1"},Mt={class:"text-muted small"},Lt={class:"price-info"},Ot={class:"fw-bold text-success fs-5"},jt={class:"text-muted small"},Ut={class:"mb-1"},Bt={class:"badge bg-info text-dark ms-1"},Ht={key:0},Jt={class:"badge bg-warning text-dark ms-1"},qt={class:"quantity-controls p-2 rounded bg-light"},Wt={class:"d-flex align-items-center justify-content-between flex-wrap gap-2"},Gt={class:"d-flex align-items-center"},Xt=["onUpdate:modelValue","onChange"],Yt={class:"ms-2"},Kt={class:"badge bg-success"},Qt={class:"d-grid mt-3"},Zt=["onClick"],te={key:3,class:"mt-4"},ee={class:"row justify-content-end"},oe={class:"col-md-4"},ae={class:"list-group"},se={class:"list-group-item d-flex justify-content-between"},ne={class:"list-group-item d-flex justify-content-between"},le={class:"list-group-item d-flex justify-content-between"},re={class:"list-group-item d-flex justify-content-between bg-light"},de={class:"fw-bold text-success"},ie={key:3,class:"alert alert-info mt-4"},ce={__name:"CarritoView",setup(ue){const h=tt(),W=f(0),r=f([]),A=f(0),z=f(!1),_=f(!1),n=f({Nombre:"",Ciudad:"",Fecha:"",Vendedor:""}),w=f(0),C=f(0),P=f(0),F=()=>{w.value=0,C.value=0,P.value=0,r.value.forEach(a=>{const e=a.PrecioFarmacia*a.cantidad,o=Number(a.IVA);o>0?(w.value+=e,P.value+=e*(o/100)):C.value+=e}),A.value=w.value+C.value+P.value};et(()=>{const a=JSON.parse(localStorage.getItem("carrito"))||[];r.value=a,V(),F(),n.value.Fecha=new Date().toISOString().split("T")[0];const e=window.matchMedia("(max-width: 767px)"),o=s=>{z.value=s.matches!==void 0?s.matches:e.matches};o(e);try{e.addEventListener("change",o)}catch{e.addListener(o)}ot(()=>{try{e.removeEventListener("change",o)}catch{e.removeListener(o)}})});const V=()=>{A.value=r.value.reduce((a,e)=>{const o=e.IVA>0?e.IVA:0,s=e.PrecioFarmacia*e.cantidad*(1+o/100);return a+s},0)},M=(a,e,o)=>{r.value[a].cantidad<1&&(r.value[a].cantidad=1),localStorage.setItem("carrito",JSON.stringify(r.value)),V(),F(),W.value=T(e,o).total},L=a=>{try{D.confirm("Confirmar eliminaci√≥n","¬øDesea eliminar este producto del carrito?",function(){r.value.splice(a,1),localStorage.setItem("carrito",JSON.stringify(r.value)),V(),F(),h.success("Producto eliminado")},function(){})}catch{r.value.splice(a,1),localStorage.setItem("carrito",JSON.stringify(r.value)),V(),F()}},G=async()=>{const e=["Nombre","Ciudad","Fecha","Vendedor","Tipo"].filter(o=>!n.value[o]);if(e.length){D.alert(`‚ùå Faltan campos obligatorios: ${e.join(", ")}`);return}_.value=!0;try{const o=new nt.Workbook,s=o.addWorksheet(n.value.Tipo);s.addRow([`Datos ${n.value.Tipo}`]),s.addRow(["Nombre",n.value.Nombre]),s.addRow(["Ciudad",n.value.Ciudad]),s.addRow(["Fecha",n.value.Fecha]),s.addRow(["Vendedor",n.value.Vendedor]),s.addRow(["Tipo",n.value.Tipo]),s.addRow([]);let c=[],m=[];n.value.Tipo==="Pedido"&&(c=["Cantidad","Promoci√≥n","NombreProducto","Lote","Fecha de Vencimiento"],m=r.value.map(l=>{const{promo:b,total:y,detalle:i,cantidad:v}=T(l.cantidad,l.Promocion);return[l.cantidad,b,l.NombreProducto,"",""]})),n.value.Tipo==="Proforma"&&(c=["Cantidad","Promoci√≥n","Nombre Producto","Marca","Precio","Total"],m=r.value.map(l=>{const b=l.PVP*l.cantidad;return[l.cantidad,T(l.cantidad,l.Promocion).promo,l.NombreProducto,l.Marca,l.PrecioFarmacia,b.toFixed(2)]}));const N=s.addRow(c);if(N.height=30,N.eachCell(l=>{l.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFCCE5FF"}},l.font={bold:!0,size:12,color:{argb:"FF000000"}},l.alignment={horizontal:"center",vertical:"middle",wrapText:!0},l.border={top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}}}),n.value.Tipo==="Pedido"&&(s.getColumn(1).width=15,s.getColumn(2).width=15,s.getColumn(3).width=35,s.getColumn(4).width=40,s.getColumn(5).width=40),n.value.Tipo==="Proforma"&&(s.getColumn(1).width=15,s.getColumn(2).width=15,s.getColumn(3).width=35,s.getColumn(4).width=35,s.getColumn(5).width=15,s.getColumn(6).width=20),m.forEach(l=>{const b=s.addRow(l);b.height=55,b.eachCell(y=>{y.border={top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}},y.alignment={vertical:"middle",horizontal:"center",wrapText:!0}})}),n.value.Tipo==="Proforma"){s.addRow([]);const l=s.addRow(["","","","","Subtotal 15%:",`$ ${w.value.toFixed(2)}`]),b=s.addRow(["","","","","Subtotal 0%:",`$ ${C.value.toFixed(2)}`]),y=s.addRow(["","","","","IVA 15%:",`$ ${P.value.toFixed(2)}`]),i=s.addRow(["","","","","VALOR TOTAL:",`$ ${A.value.toFixed(2)}`]);[l,b,y,i].forEach(v=>{v.eachCell(g=>{g.value?.toString().trim()&&(g.border={top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}},g.alignment={vertical:"middle",horizontal:"center",wrapText:!0},g.font={bold:!0})})})}const $=await o.xlsx.writeBuffer(),S=`${n.value.Tipo}_Cliente_${n.value.Nombre}_ciudad_${n.value.Ciudad}_Cliente_${n.value.Fecha}.xlsx`;q.saveAs(new Blob([$]),S),h.success("Excel generado correctamente")}catch(o){console.error("Error generando Excel:",o),h.error("Ocurri√≥ un error al generar el Excel")}finally{_.value=!1}},X=async()=>{try{D.confirm("Vaciar carrito","¬øEst√° seguro que desea vaciar todo el carrito? Esta acci√≥n no se puede deshacer.",function(){localStorage.removeItem("carrito"),r.value=[],V(),F(),h.success("Carrito vaciado")},function(){})}catch{localStorage.removeItem("carrito"),r.value=[]}},Y=async()=>{if(!n.value.Nombre.trim()){D.alert("Campo obligatorio","‚ùå Por favor, ingrese el nombre del cliente antes de exportar");return}_.value=!0;let a=null;try{const e=new Date().toISOString().split("T")[0],o=n.value.Nombre.trim().replace(/\s+/g,"_"),s=500;a=document.createElement("div"),a.style.width=s+"px",a.style.padding="5px",a.style.backgroundColor="white",a.style.boxSizing="border-box",a.style.fontFamily="'Segoe UI', Roboto, Arial, sans-serif",a.style.margin="0 auto",a.style.color="#222",a.style.border="1px solid #e6e6e6",a.style.fontSize="14px",a.style.lineHeight="1.25",a.style.setProperty("-webkit-font-smoothing","antialiased"),a.style.setProperty("text-rendering","optimizeLegibility");const c=document.createElement("h2");c.textContent=`Lista productos MH - ${n.value.Nombre} - ${e}`,c.style.textAlign="center",c.style.margin="10px 0 12px 0",c.style.fontSize="14px",c.style.color="#333",a.appendChild(c);const m=document.createElement("table");m.style.borderCollapse="collapse",m.style.width="100%",m.style.tableLayout="fixed";const N=document.createElement("colgroup");[40,15,25,20].forEach(i=>{const v=document.createElement("col");v.style.width=i+"%",N.appendChild(v)}),m.appendChild(N);const $=document.createElement("thead");$.innerHTML=`
      <tr style="background-color: #4CAF50; color: white;">
        <th style="padding: 6px; border: 1px solid #ddd; font-size:12px; text-align:center;">Producto</th>
        <th style="padding: 6px; border: 1px solid #ddd; font-size:12px; text-align:center;">Precio</th>
        <th style="padding: 6px; border: 1px solid #ddd; font-size:12px; text-align:center;">Promoci√≥n</th>
        <th style="padding: 6px; border: 1px solid #ddd; font-size:12px; text-align:center;">Descuento %</th>
      </tr>
    `,m.appendChild($);const S=document.createElement("tbody");if(r.value.forEach((i,v)=>{const g=document.createElement("tr");g.style.backgroundColor=v%2===0?"#f9f9f9":"white";const O=i.NombreProducto||"",K=i.PrecioFarmacia!==void 0&&i.PrecioFarmacia!==null?"$"+Number(i.PrecioFarmacia).toFixed(2):"N/D",Q=i.Promocion||"";let j="";if(i.Descuento!==void 0&&i.Descuento!==null){const R=Number(i.Descuento);!isNaN(R)&&R!==0&&(j=String(R)+" %")}g.innerHTML=`
        <td style="padding: 3px; border: 1px solid #ddd; font-size:12px; text-align:left; word-break:break-word;">${O}</td>
        <td style="padding: 3px; border: 1px solid #ddd; font-size:12px; text-align:center;">${K}</td>
        <td style="padding: 3px; border: 1px solid #ddd; font-size:12px; text-align:center; word-break:break-word;">${Q}</td>
        <td style="padding: 3px; border: 1px solid #ddd; font-size:12px; text-align:center;">${j}</td>
      `,S.appendChild(g)}),m.appendChild(S),a.appendChild(m),a.style.position="fixed",a.style.left="50%",a.style.top="-9999px",a.style.transform="translateX(-50%)",document.body.appendChild(a),await new Promise(i=>requestAnimationFrame(()=>setTimeout(i,80))),document.fonts&&document.fonts.ready)try{await document.fonts.ready}catch{}const l=(await st(async()=>{const{default:i}=await import("./html2canvas.esm-B0tyYwQk.js");return{default:i}},[])).default,b=Math.min(3,window.devicePixelRatio||1);(await l(a,{backgroundColor:"white",scale:b,useCORS:!0,logging:!1})).toBlob(i=>{if(i){const v=`lista_precios_MH_cliente_${o}_${e}.png`;q.saveAs(i,v),h.success("Imagen descargada correctamente")}else h.error("No se pudo generar la imagen")},"image/png")}catch(e){console.error("Error generando imagen:",e),h.error("No se pudo generar la imagen. Intente nuevamente o use Exportar Excel.")}finally{try{a&&document.body.contains(a)&&document.body.removeChild(a)}catch{}_.value=!1}};return(a,e)=>(p(),u("div",lt,[e[26]||(e[26]=t("h2",{class:"text-center mb-4",style:{"margin-top":"60px"}}," üõí Carrito de Compras ",-1)),r.value.length?(p(),u("div",rt,[t("div",dt,[e[5]||(e[5]=t("label",{class:"form-label"},"Nombre cliente",-1)),x(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>n.value.Nombre=o),type:"text",class:"form-control"},null,512),[[k,n.value.Nombre]])]),t("div",it,[e[6]||(e[6]=t("label",{class:"form-label"},"Ciudad",-1)),x(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>n.value.Ciudad=o),type:"text",class:"form-control"},null,512),[[k,n.value.Ciudad]])]),t("div",ct,[e[7]||(e[7]=t("label",{class:"form-label"},"Fecha",-1)),x(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>n.value.Fecha=o),type:"date",readonly:"",disabled:"",class:"form-control"},null,512),[[k,n.value.Fecha]])]),t("div",ut,[e[9]||(e[9]=t("label",{class:"form-label"},"Vendedor",-1)),x(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>n.value.Vendedor=o),class:"form-select"},[...e[8]||(e[8]=[t("option",{value:"",disabled:"",selected:""},"Seleccione",-1),t("option",{value:"Diana Benalc√°zar"},"Diana Benalc√°zar",-1)])],512),[[U,n.value.Vendedor]])]),t("div",pt,[e[11]||(e[11]=t("label",{class:"form-label"},"Tipo de documento",-1)),x(t("select",{"onUpdate:modelValue":e[4]||(e[4]=o=>n.value.Tipo=o),class:"form-select"},[...e[10]||(e[10]=[t("option",{value:"",disabled:"",selected:""},"Seleccione",-1),t("option",{value:"Pedido"},"Pedido",-1),t("option",{value:"Proforma"},"Proforma",-1)])],512),[[U,n.value.Tipo]])])])):E("",!0),r.value.length?(p(),u("div",mt,[t("button",{onClick:X,class:"btn btn-warning"}," Vaciar carrito "),t("button",{class:"btn btn-primary",onClick:G,disabled:!r.value.length}," Exportar Excel ",8,bt),t("button",{class:"btn btn-success",onClick:Y,disabled:!r.value.length}," Exportar Imagen promociones ",8,vt)])):E("",!0),r.value.length?(p(),u("div",ft,[_.value?(p(),u("div",gt,[...e[12]||(e[12]=[t("div",{class:"export-spinner","aria-hidden":"true"},null,-1),t("div",{class:"export-text"},"Generando archivo, por favor espere...",-1)])])):E("",!0),z.value?(p(),u("div",St,[(p(!0),u(B,null,H(r.value,(o,s)=>(p(),u("div",{key:o.id,class:"card mb-3 mobile-card"},[t("div",It,[t("div",Dt,[t("div",Rt,[t("h5",zt,d(o.NombreProducto),1),t("div",Mt,[t("div",null,[e[14]||(e[14]=t("strong",null,"Marca:",-1)),I(" "+d(o.Marca),1)]),t("div",null,[e[15]||(e[15]=t("strong",null,"Presentaci√≥n:",-1)),I(" "+d(o.Presentacion),1)]),t("div",null,[e[16]||(e[16]=t("strong",null,"P. Activo:",-1)),I(" "+d(o.PrincipioActivo||"-"),1)])])]),t("div",Lt,[t("div",Ot," $ "+d(Number(o.PrecioFarmacia).toFixed(2)),1),t("div",jt," IVA: "+d(o.IVA>0?o.IVA+"%":"No aplica"),1)])]),t("div",{class:at(["promo-info p-2 mb-2 rounded",o.Promocion?"bg-light":""])},[t("div",Ut,[e[17]||(e[17]=t("strong",{class:"text-primary"},"Promoci√≥n:",-1)),t("span",Bt,d(o.Promocion||"Sin promoci√≥n"),1)]),o.Descuento&&Number(o.Descuento)!==0?(p(),u("div",Ht,[e[18]||(e[18]=t("strong",{class:"text-primary"},"Descuento:",-1)),t("span",Jt,d(o.Descuento)+"%",1)])):E("",!0)],2),t("div",qt,[t("div",Wt,[t("div",Gt,[e[19]||(e[19]=t("label",{class:"me-2 fw-bold mb-0"},"Cantidad:",-1)),x(t("input",{type:"number",min:"0","onUpdate:modelValue":c=>o.cantidad=c,onChange:c=>M(s,o.cantidad,o.Promocion),class:"form-control",style:{width:"80px"}},null,40,Xt),[[k,o.cantidad,void 0,{number:!0}]])]),t("div",Yt,[e[20]||(e[20]=t("strong",null,"A recibir: ",-1)),t("span",Kt,d(J(T)(o.cantidad,o.Promocion).total),1)])])]),t("div",Qt,[t("button",{class:"btn btn-outline-danger",onClick:c=>L(s)},[...e[21]||(e[21]=[t("i",{class:"fas fa-trash-alt me-2"},null,-1),I("Eliminar producto ",-1)])],8,Zt)])])]))),128))])):(p(),u("div",ht,[t("table",xt,[e[13]||(e[13]=t("thead",null,[t("tr",null,[t("th",{class:"text-wrap fs-6 text"},"Nombre"),t("th",{class:"text-wrap fs-6 text"},"Presentaci√≥n"),t("th",{class:"text-wrap fs-6 text"},"Principio Activo"),t("th",{class:"text-wrap fs-6 text"},"PVP"),t("th",{class:"text-wrap fs-6 text"},"Promoci√≥n"),t("th",{class:"text-wrap fs-6 text"},"Descuento"),t("th",{class:"text-wrap fs-6 text"},"Marca"),t("th",{class:"text-wrap fs-6 text"},"IVA"),t("th",{class:"text-wrap fs-6 text"},"Cantidad"),t("th",{class:"text-wrap fs-6 text"},"A recibir"),t("th",{class:"text-wrap fs-6 text"},"Acciones")])],-1)),t("tbody",null,[(p(!0),u(B,null,H(r.value,(o,s)=>(p(),u("tr",{key:o.id},[t("td",yt,d(o.NombreProducto),1),t("td",_t,d(o.Presentacion),1),t("td",wt,d(o.PrincipioActivo),1),t("td",Ct,"$ "+d(o.PrecioFarmacia),1),t("td",Pt,d(o.Promocion),1),t("td",Ft,d(o.Descuento!==void 0&&o.Descuento!==null&&Number(o.Descuento)!==0?o.Descuento:""),1),t("td",Vt,d(o.Marca),1),t("td",Nt,d(o.IVA>0?o.IVA+"%":"No aplica"),1),t("td",Et,[x(t("input",{type:"number",min:"0","onUpdate:modelValue":c=>o.cantidad=c,onChange:c=>M(s,o.cantidad,o.Promocion),class:"form-control form-control-sm",style:{width:"80px"}},null,40,kt),[[k,o.cantidad,void 0,{number:!0}]])]),t("td",Tt,d(J(T)(o.cantidad,o.Promocion).total),1),t("td",At,[t("button",{class:"btn btn-danger btn-sm",onClick:c=>L(s)}," Eliminar ",8,$t)])]))),128))])])])),r.value.length?(p(),u("div",te,[t("div",ee,[t("div",oe,[t("ul",ae,[t("li",se,[e[22]||(e[22]=t("strong",null,"Subtotal 15%:",-1)),t("span",null,"$ "+d(w.value.toFixed(2)),1)]),t("li",ne,[e[23]||(e[23]=t("strong",null,"Subtotal 0%:",-1)),t("span",null,"$ "+d(C.value.toFixed(2)),1)]),t("li",le,[e[24]||(e[24]=t("strong",null,"IVA 15%:",-1)),t("span",null,"$ "+d(P.value.toFixed(2)),1)]),t("li",re,[e[25]||(e[25]=t("strong",null,"Total:",-1)),t("span",de,"$ "+d(A.value.toFixed(2)),1)])])])])])):E("",!0)])):(p(),u("div",ie,"El carrito est√° vac√≠o."))]))}},fe=Z(ce,[["__scopeId","data-v-01025b22"]]);export{fe as default};
