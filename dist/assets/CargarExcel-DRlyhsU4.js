import{r as C,u as S}from"./xlsx-hAyDQTdp.js";import{a as d}from"./alertify-DPht8m50.js";import{_ as $,r as p,b as s,d as l,n as D,e as t,k as g,h as M,F as V,j as _,m as L,f as B,t as o,p as w}from"./index-Bz6ZYZ6P.js";import{L as H}from"./LoadingComponent-CaafU0U-.js";const R={class:"cargar-excel"},T={key:0},G={key:1},O={key:0,class:"mt-3"},z={key:1,class:"table-responsive mt-4"},J={class:"table table-bordered table-sm formato-tabla"},U={__name:"CargarExcel",setup(q){const v=p(!1),u=p([]),i=p([]),A=L(),E=m=>{v.value=!0;const e=m.target.files[0];if(!e){v.value=!1;return}const a=new FileReader;a.onload=f=>{try{const b=new Uint8Array(f.target.result),y=C(b,{type:"array"});i.value=[];let N=[];y.SheetNames.forEach((P,x)=>{const j=y.Sheets[P];S.sheet_to_json(j).forEach((r,h)=>{const c={ID:`id-${h}-${r.NombreProducto.split(" ")[0]}-${Math.random().toString(36).substr(2,5)}`,NombreProducto:r.NombreProducto??"",Presentacion:r.Presentacion??"",PrincipioActivo:r.PrincipioActivo??"",PrecioFarmacia:parseFloat(r.PrecioFarmacia??""),PVP:parseFloat(r.PVP??""),Promocion:r.Promocion??"",Descuento:parseInt(r.Descuento??0),Marca:r.Marca??"",IVA:parseInt(r.IVA??0)},n=[];c.NombreProducto||n.push("Nombre vac√≠o"),c.Presentacion||n.push("Presentaci√≥n vac√≠a"),c.PrincipioActivo||n.push("Principio activo vac√≠o"),isNaN(c.PrecioFarmacia)&&n.push("Precio farmacia inv√°lido"),isNaN(c.PVP)&&n.push("PVP inv√°lido"),c.Marca||n.push("Marca vac√≠a"),isNaN(c.IVA)&&n.push("IVA inv√°lido"),n.length>0&&(i.value.push({hoja:P,fila:h+2,errores:n,id:`${x}${h}`}),console.log(`Hoja: ${P}, Fila ${h+2}`,r)),N.push(c)})}),u.value=N,i.value.length>0?d.error("‚ùå Hay errores en el archivo. Revisa las filas marcadas."):d.success("‚úÖ Archivo cargado correctamente")}catch(b){d.error("‚ùå Error al procesar el archivo."),console.error("Error al leer Excel:",b)}finally{v.value=!1}},a.readAsArrayBuffer(e)},I=m=>{const e=u.value[m];return i.value.some(a=>a.id===e.ID)},k=()=>{if(i.value.length>0){d.error("‚ùå No se puede guardar. Corrige los errores primero.");return}localStorage.removeItem("ListaProductos"),localStorage.setItem("ListaProductos",JSON.stringify(u.value)),d.success("‚úÖ Productos guardados en memoria"),setTimeout(()=>{A.push("/Productos")},1e3)},F=()=>{d.confirm("‚ö†Ô∏è Confirmaci√≥n","¬øEst√°s seguro de eliminar todos los productos cargados?",()=>{localStorage.removeItem("ListaProductos"),d.success("‚úÖ Archivos eliminados")},()=>{d.error("‚ùå Operaci√≥n cancelada")})};return(m,e)=>(l(),s("div",R,[e[3]||(e[3]=D('<h2 data-v-6b0029ff>üì• Cargar productos desde Excel</h2><p data-v-6b0029ff>üìù El archivo debe tener las siguientes columnas:</p><div class="table-responsive" data-v-6b0029ff><table class="table table-bordered formato-tabla" data-v-6b0029ff><thead data-v-6b0029ff><tr data-v-6b0029ff><th data-v-6b0029ff>NombreProducto</th><th data-v-6b0029ff>Presentacion</th><th data-v-6b0029ff>PrincipioActivo</th><th data-v-6b0029ff>PrecioFarmacia</th><th data-v-6b0029ff>PVP</th><th data-v-6b0029ff>Promocion</th><th data-v-6b0029ff>Descuento</th><th data-v-6b0029ff>Marca</th><th data-v-6b0029ff>IVA</th></tr></thead><tbody data-v-6b0029ff><tr data-v-6b0029ff><td data-v-6b0029ff>Paracetamol 500mg</td><td data-v-6b0029ff>Caja x 10</td><td data-v-6b0029ff>Paracetamol</td><td data-v-6b0029ff>1.50</td><td data-v-6b0029ff>2.00</td><td data-v-6b0029ff>2x1</td><td data-v-6b0029ff>10</td><td data-v-6b0029ff>Genfar</td><td data-v-6b0029ff>15</td></tr></tbody></table></div>',3)),t("input",{type:"file",onChange:E,accept:".xlsx, .xls",class:"form-control my-3"},null,32),t("div",null,[u.value.length?(l(),s("button",{key:0,onClick:k,class:"btn btn-success m-5"}," Guardar productos en memoria ")):g("",!0),t("button",{onClick:F,class:"btn btn-danger m-1"}," Eliminar productos registrados ")]),v.value?(l(),s("div",T,[M(H)])):(l(),s("div",G,[i.value.length?(l(),s("div",O,[e[0]||(e[0]=t("h5",{class:"text-danger"},"‚ùå Errores detectados:",-1)),t("ul",null,[(l(!0),s(V,null,_(i.value,a=>(l(),s("li",{key:`${a.hoja}-${a.fila}`},[t("strong",null,"Hoja "+o(a.hoja)+", Fila "+o(a.fila)+":",1),B(" "+o(a.errores.join(", ")),1)]))),128))])])):g("",!0),u.value.length?(l(),s("div",z,[e[2]||(e[2]=t("h4",null,"üëÄ Vista previa de productos cargados",-1)),t("table",J,[e[1]||(e[1]=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"NombreProducto"),t("th",null,"Presentacion"),t("th",null,"PrincipioActivo"),t("th",null,"PrecioFarmacia"),t("th",null,"PVP"),t("th",null,"Promocion"),t("th",null,"Descuento"),t("th",null,"Marca"),t("th",null,"IVA")])],-1)),t("tbody",null,[(l(!0),s(V,null,_(u.value,(a,f)=>(l(),s("tr",{key:f,class:w({"table-danger":I(f)})},[t("td",null,o(f+1),1),t("td",null,o(a.NombreProducto),1),t("td",null,o(a.Presentacion),1),t("td",null,o(a.PrincipioActivo),1),t("td",null,o(a.PrecioFarmacia),1),t("td",null,o(a.PVP),1),t("td",null,o(a.Promocion),1),t("td",null,o(a.Descuento),1),t("td",null,o(a.Marca),1),t("td",null,o(a.IVA),1)],2))),128))])])])):g("",!0)]))]))}},Z=$(U,[["__scopeId","data-v-6b0029ff"]]);export{Z as default};
