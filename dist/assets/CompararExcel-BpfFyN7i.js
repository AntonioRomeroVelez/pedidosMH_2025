import{_ as D,r as C,c as F,b as O,d as v,e as t,j as I,g as R,t as n,w as M,y as _,q as x,F as w,i as V,s as y}from"./index-B5-_-OQ-.js";import{r as B,u as k}from"./xlsx-hAyDQTdp.js";import{E as L}from"./exceljs.min-BU0hMcfI.js";import{F as j}from"./FileSaver.min-CE0WTsoJ.js";const z={class:"container py-4",style:{"margin-top":"80px"}},U={class:"row g-4"},G={class:"col-md-6"},$={class:"card shadow-sm"},q={class:"card-body"},W={key:0,class:"mt-2 text-success small"},J={class:"col-md-6"},K={class:"card shadow-sm"},H={class:"card-body"},Q={key:0,class:"mt-2 text-success small"},X={class:"text-center mt-4"},Y=["disabled"],Z={key:0,class:"mt-4 text-center"},tt={key:1,class:"mt-5"},et={class:"table-responsive"},ot={class:"table table-bordered table-hover align-middle"},at={__name:"CompararExcel",setup(lt){const E=C([]),p=C([]),A=C([]),b=C(""),N=C(""),f=C("Todos");function c(r){return r?r.toString().toLowerCase().replace(/\s+/g," ").trim():""}function P(r,e){const o=r.target.files[0];if(o)try{const u=new FileReader;u.onload=a=>{const d=new Uint8Array(a.target.result),l=B(d,{type:"array"}),s=l.Sheets[l.SheetNames[0]],m=k.sheet_to_json(s,{defval:""}).map(i=>({CODIGO:i.CODIGO?.toString().trim()||"",MARCA:i.MARCA?.toString().trim()||"",NOMBRE:i.NOMBRE?.toString().trim()||"",PRESENTACION:i.PRESENTACION?.toString().trim()||"",PRINCIPIO_ACTIVO:i.PRINCIPIO_ACTIVO?.toString().trim()||"",P_FARMACIA:parseFloat(i.P_FARMACIA)||0,PVP:parseFloat(i.PVP)||0,PROMOCION:i.PROMOCION?.toString().trim()||"",DESCUENTO:i.DESCUENTO?.toString().trim()||"",IVA:i.IVA?.toString().trim()||""}));e==="base"?(E.value=m,b.value=o.name):(p.value=m,N.value=o.name)},u.readAsArrayBuffer(o)}catch{alert("âš ï¸ Error al leer el archivo. Verifica que el formato sea vÃ¡lido (.xlsx o .xls).")}}function S(){if(!E.value.length||!p.value.length){alert("âš ï¸ Debes cargar ambos archivos antes de comparar.");return}const r=new Set(p.value.map(a=>c(a.MARCA))),e=E.value.filter(a=>r.has(c(a.MARCA))),o=[],u=new Map;for(const a of e){const d=[c(a.MARCA),c(a.NOMBRE),c(a.PRESENTACION),c(a.PRINCIPIO_ACTIVO)].join("|");u.set(d,a)}for(const a of p.value){const d=[c(a.MARCA),c(a.NOMBRE),c(a.PRESENTACION),c(a.PRINCIPIO_ACTIVO)].join("|"),l=u.get(d);if(!l)o.push({...a,ESTADO:"Nuevo",DETALLE_CAMBIO:"Registro nuevo"}),E.value.push({...a,ESTADO:"Nuevo",DETALLE_CAMBIO:"Registro nuevo"});else{const s=[];a.P_FARMACIA!==l.P_FARMACIA&&s.push("P_FARMACIA"),a.PVP!==l.PVP&&s.push("PVP"),a.PROMOCION!==l.PROMOCION&&s.push("PROMOCION"),a.DESCUENTO!==l.DESCUENTO&&s.push("DESCUENTO"),a.IVA!==l.IVA&&s.push("IVA"),s.length?(Object.assign(l,a,{ESTADO:"Actualizado",DETALLE_CAMBIO:s.join(", ")}),o.push({...l})):(Object.assign(l,{ESTADO:"Sin cambios",DETALLE_CAMBIO:""}),o.push({...l})),u.delete(d)}}for(const a of u.values())a.ESTADO="Eliminado",a.DETALLE_CAMBIO="Producto eliminado (no estÃ¡ en nuevo Excel)",o.push(a);A.value=o.sort((a,d)=>{const l=a.MARCA.localeCompare(d.MARCA);return l!==0?l:a.NOMBRE.localeCompare(d.NOMBRE)})}const T=F(()=>f.value==="Todos"?A.value:A.value.filter(r=>r.ESTADO===f.value));async function g(){if(!A.value.length)return;const r=new L.Workbook,e=r.addWorksheet("Productos Actualizados"),o=["CODIGO","MARCA","NOMBRE","PRESENTACION","PRINCIPIO_ACTIVO","P_FARMACIA","PVP","PROMOCION","DESCUENTO","IVA","ESTADO","DETALLE_CAMBIO"];e.addRow(o),e.getRow(1).eachCell(s=>{s.font={bold:!0,color:{argb:"FFFFFFFF"}},s.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF1F4E78"}},s.alignment={vertical:"middle",horizontal:"center"}});for(const s of A.value){const h=e.addRow(Object.values(s));let m="FFFFFFFF";s.ESTADO==="Nuevo"?m="FFB7E1CD":s.ESTADO==="Actualizado"?m="FFFFF3CD":s.ESTADO==="Eliminado"&&(m="FFF8D7DA"),h.eachCell(i=>{i.fill={type:"pattern",pattern:"solid",fgColor:{argb:m}}})}const a=new Date().toISOString().split("T")[0],d=b.value?b.value.replace(/\.xlsx$/i,`_Revisado_${a}.xlsx`):`Productos_Revisados_${a}.xlsx`,l=await r.xlsx.writeBuffer();j.saveAs(new Blob([l]),d)}return(r,e)=>(v(),O("div",z,[e[13]||(e[13]=t("h2",{class:"text-center mb-4"},"ðŸ“Š Comparador de Archivos Excel",-1)),t("div",U,[t("div",G,[t("div",$,[t("div",q,[e[4]||(e[4]=t("h5",{class:"card-title"},"ðŸ“˜ Archivo base (anterior)",-1)),t("input",{type:"file",accept:".xlsx,.xls",class:"form-control",onChange:e[0]||(e[0]=o=>P(o,"base"))},null,32),b.value?(v(),O("div",W,[e[3]||(e[3]=t("i",{class:"bi bi-file-earmark-excel"},null,-1)),R(" "+n(b.value),1)])):I("",!0)])])]),t("div",J,[t("div",K,[t("div",H,[e[6]||(e[6]=t("h5",{class:"card-title"},"ðŸ“— Archivo nuevo",-1)),t("input",{type:"file",accept:".xlsx,.xls",class:"form-control",onChange:e[1]||(e[1]=o=>P(o,"nuevo"))},null,32),N.value?(v(),O("div",Q,[e[5]||(e[5]=t("i",{class:"bi bi-file-earmark-excel"},null,-1)),R(" "+n(N.value),1)])):I("",!0)])])])]),t("div",X,[t("button",{class:"btn btn-primary px-4 me-2",disabled:!E.value.length||!p.value.length,onClick:S},[...e[7]||(e[7]=[t("i",{class:"bi bi-arrow-repeat"},null,-1),R(" Comparar archivos ",-1)])],8,Y),A.value.length?(v(),O("button",{key:0,class:"btn btn-success px-4",onClick:g},[...e[8]||(e[8]=[t("i",{class:"bi bi-file-earmark-arrow-down"},null,-1),R(" Descargar plantilla actualizada ",-1)])])):I("",!0)]),A.value.length?(v(),O("div",Z,[e[10]||(e[10]=t("label",{class:"fw-bold me-2"},"Filtrar por estado:",-1)),M(t("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>f.value=o),class:"form-select d-inline-block w-auto"},[...e[9]||(e[9]=[x('<option value="Todos" data-v-42cbb30a>Todos</option><option value="Nuevo" data-v-42cbb30a>Nuevos</option><option value="Actualizado" data-v-42cbb30a>Actualizados</option><option value="Eliminado" data-v-42cbb30a>Eliminados</option><option value="Sin cambios" data-v-42cbb30a>Sin cambios</option>',5)])],512),[[_,f.value]])])):I("",!0),A.value.length?(v(),O("div",tt,[e[12]||(e[12]=t("h4",{class:"mb-3"},"Resultado de la comparaciÃ³n",-1)),t("div",et,[t("table",ot,[e[11]||(e[11]=t("thead",{class:"table-light"},[t("tr",null,[t("th",null,"CODIGO"),t("th",null,"MARCA"),t("th",null,"NOMBRE"),t("th",null,"PRESENTACION"),t("th",null,"PRINCIPIO_ACTIVO"),t("th",null,"P_FARMACIA"),t("th",null,"PVP"),t("th",null,"PROMOCION"),t("th",null,"DESCUENTO"),t("th",null,"IVA"),t("th",null,"ESTADO"),t("th",null,"DETALLE_CAMBIO")])],-1)),t("tbody",null,[(v(!0),O(w,null,V(T.value,(o,u)=>(v(),O("tr",{key:u,class:y({"table-success":o.ESTADO==="Nuevo","table-warning":o.ESTADO==="Actualizado","table-danger":o.ESTADO==="Eliminado"})},[t("td",null,n(o.CODIGO),1),t("td",null,n(o.MARCA),1),t("td",null,n(o.NOMBRE),1),t("td",null,n(o.PRESENTACION),1),t("td",null,n(o.PRINCIPIO_ACTIVO),1),t("td",null,n(o.P_FARMACIA),1),t("td",null,n(o.PVP),1),t("td",null,n(o.PROMOCION),1),t("td",null,n(o.DESCUENTO),1),t("td",null,n(o.IVA),1),t("td",null,[t("strong",null,n(o.ESTADO),1)]),t("td",null,n(o.DETALLE_CAMBIO),1)],2))),128))])])])])):I("",!0)]))}},ut=D(at,[["__scopeId","data-v-42cbb30a"]]);export{ut as default};
