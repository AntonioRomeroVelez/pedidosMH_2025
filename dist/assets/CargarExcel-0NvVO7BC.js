import{_ as j,m as B,n as U,r as u,o as z,c as G,a as $,b as n,d as c,q as J,e as t,j as v,g,t as a,h as N,k as W,w as q,s as H,F as K,i as Q,x as X}from"./index-DREQ0Xr5.js";import{r as Y,u as Z}from"./xlsx-hAyDQTdp.js";import{E as tt}from"./exceljs.min-Dkq9GScd.js";import{F as et}from"./FileSaver.min-SHCrSFge.js";import{L as ot}from"./LoadingComponent-Cn_PwVSR.js";const at={class:"cargar-excel container",style:{"margin-top":"60px"}},rt={class:"mb-4"},st={class:"input-group"},dt={key:0,class:"form-text text-success mt-2"},lt={key:0,class:"alert alert-info"},it={class:"mb-0"},nt={class:"mb-4"},ct={key:1},ut={key:2},pt={key:0,class:"mb-3 text-end"},mt={key:1,class:"vista-previa mt-4"},vt={class:"table-responsive shadow-sm rounded-4 border position-relative",style:{"max-height":"70vh","overflow-y":"auto"}},ht={class:"table table-hover align-middle text-center table-striped",style:{"min-width":"950px","word-wrap":"break-word","table-layout":"fixed"}},bt={class:"text-break"},gt={class:"text-break"},xt={class:"text-break"},ft={class:"text-break"},yt={class:"text-break"},Pt={class:"text-break"},wt={__name:"CargarExcel",setup(_t){const p=B(),E=U(),x=u(!1),r=u([]),A=u([]),m=u([]),_=u(""),I=u(0),f=u(!1),y=u("todos");z(()=>{const s=localStorage.getItem("ListaProductos");s&&(r.value=JSON.parse(s))});const R=G(()=>y.value==="repetidos"?r.value.filter(s=>s.duplicado):y.value==="noRepetidos"?r.value.filter(s=>!s.duplicado):r.value),V=s=>{x.value=!0;const e=s.target.files[0];if(!e){x.value=!1;return}_.value=e.name;const h=new FileReader;h.onload=o=>{try{const d=new Uint8Array(o.target.result),C=Y(d,{type:"array"});A.value=[],m.value=[],f.value=!1;let P=[];C.SheetNames.forEach(l=>{const b=C.Sheets[l];Z.sheet_to_json(b).forEach(F=>{const i={};Object.keys(F).forEach(S=>{const L=S.normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim().toUpperCase();i[L]=F[S]});const M=i.CODIGO?.toString().trim()||"",T={ID:crypto.randomUUID(),Codigo:M,Marca:i.MARCA?.toString().trim()||"",NombreProducto:i.NOMBRE?.toString().trim()||"",Presentacion:i.PRESENTACION?.toString().trim()||"",PrincipioActivo:i.PRINCIPIO_ACTIVO?.toString().trim()||"",PrecioFarmacia:parseFloat((i.P_FARMACIA||"0").toString().replace(",","."))||0,PVP:parseFloat((i.PVP||"0").toString().replace(",","."))||0,Promocion:i.PROMOCION||"",Descuento:parseFloat((i.DESCUENTO||"0").toString())||0,IVA:parseFloat((i.IVA||"0").toString().replace(",","."))||0,duplicado:!1};P.push(T)})});const w=l=>(l||"").toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"").toLowerCase(),k=new Map;P.forEach(l=>{const b=`${w(l.Marca)}|${w(l.NombreProducto)}|${w(l.Presentacion)}|${w(l.PrincipioActivo)}`;k.has(b)?(l.duplicado=!0,k.get(b).duplicado=!0,f.value=!0):k.set(b,l)}),r.value=P,m.value=P.filter(l=>l.duplicado),f.value?p.error("‚ö†Ô∏è Se detectaron productos duplicados en el archivo. Revisa los resaltados en rojo."):p.success("‚úÖ Archivo cargado correctamente, sin duplicados internos.")}catch(d){p.error("‚ùå Error al procesar el archivo."),console.error("Error al leer Excel:",d)}finally{x.value=!1}},h.readAsArrayBuffer(e)},D=()=>{if(f.value){p.error("‚ùå No se puede guardar. Elimina los productos duplicados.");return}localStorage.setItem("ListaProductos",JSON.stringify(r.value)),p.success(`‚úÖ Se guardaron ${r.value.length} productos correctamente.`),setTimeout(()=>{E.push("/Productos")},1e3)};async function O(){if(!m.value.length){p.info("No hay productos repetidos para exportar");return}const s=new tt.Workbook,e=s.addWorksheet("Productos Repetidos");e.columns=[{header:"CODIGO",key:"Codigo",width:15},{header:"Marca",key:"Marca",width:20},{header:"NombreProducto",key:"NombreProducto",width:40},{header:"Presentacion",key:"Presentacion",width:25},{header:"PrincipioActivo",key:"PrincipioActivo",width:30}],m.value.forEach(d=>e.addRow(d)),e.getRow(1).eachCell(d=>{d.font={bold:!0,color:{argb:"FFFFFFFF"}},d.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFB91D1D"}},d.alignment={vertical:"middle",horizontal:"center"}});const o=await s.xlsx.writeBuffer();et.saveAs(new Blob([o]),"productos_repetidos.xlsx"),p.success("üì¶ Archivo de productos repetidos exportado correctamente")}return(s,e)=>{const h=$("RouterLink");return c(),n("div",at,[e[12]||(e[12]=J('<h2 data-v-d6de2db4>üì• Cargar productos desde Excel</h2><p data-v-d6de2db4>üìù El archivo debe tener las siguientes columnas:</p><div class="table-responsive container" data-v-d6de2db4><table class="table table-bordered formato-tabla" data-v-d6de2db4><thead data-v-d6de2db4><tr data-v-d6de2db4><th data-v-d6de2db4>CODIGO</th><th data-v-d6de2db4>Marca</th><th data-v-d6de2db4>Nombre</th><th data-v-d6de2db4>Presentacion</th><th data-v-d6de2db4>Principio_Activo</th><th data-v-d6de2db4>P_Farmacia</th><th data-v-d6de2db4>PVP</th><th data-v-d6de2db4>Promocion</th><th data-v-d6de2db4>Descuento</th><th data-v-d6de2db4>IVA</th></tr></thead><tbody data-v-d6de2db4><tr data-v-d6de2db4><td data-v-d6de2db4>2343</td><td data-v-d6de2db4>Genfar</td><td data-v-d6de2db4>Paracetamol 500mg</td><td data-v-d6de2db4>Caja x 10</td><td data-v-d6de2db4>Paracetamol</td><td data-v-d6de2db4>1.50</td><td data-v-d6de2db4>2.00</td><td data-v-d6de2db4>2x1</td><td data-v-d6de2db4>10</td><td data-v-d6de2db4>15</td></tr></tbody></table></div>',3)),t("div",rt,[e[2]||(e[2]=t("label",{for:"excelInput",class:"form-label fw-semibold text-primary"}," üìÑ Cargar archivo Excel ",-1)),t("div",st,[e[1]||(e[1]=t("label",{class:"input-group-text bg-success text-white",for:"excelInput",style:{cursor:"pointer"}},[t("i",{class:"bi bi-arrow-bar-up me-2"}),g(" Subir Excel ")],-1)),t("input",{type:"file",class:"form-control",id:"excelInput",onChange:V,accept:".xlsx, .xls"},null,32)]),_.value?(c(),n("div",dt," Archivo seleccionado: "+a(_.value),1)):v("",!0)]),r.value.length||m.value.length?(c(),n("div",lt,[e[6]||(e[6]=t("strong",null,"üìä Resumen:",-1)),t("ul",it,[t("li",null,[e[3]||(e[3]=g(" üü¢ Nuevos productos cargados: ",-1)),t("b",null,a(I.value),1)]),t("li",null,[e[4]||(e[4]=g(" üü° Productos repetidos detectados: ",-1)),t("b",null,a(m.value.length),1)]),t("li",null,[e[5]||(e[5]=g(" üì¶ Total actual en memoria: ",-1)),t("b",null,a(r.value.length),1)])])])):v("",!0),t("div",nt,[r.value.length?(c(),n("button",{key:0,onClick:D,class:"btn btn-success m-2"}," üíæ Guardar productos en memoria ")):v("",!0),m.value.length?(c(),n("button",{key:1,onClick:O,class:"btn btn-danger m-2"}," üì§ Exportar productos repetidos ")):v("",!0),N(h,{class:"btn btn-warning px-2 sm m-2",to:"/Productos"},{default:W(()=>[...e[7]||(e[7]=[g(" Cancelar ",-1)])]),_:1})]),x.value?(c(),n("div",ct,[N(ot)])):(c(),n("div",ut,[r.value.length?(c(),n("div",pt,[e[9]||(e[9]=t("label",{class:"me-2 fw-semibold text-primary"},"üîç Mostrar:",-1)),q(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>y.value=o),class:"form-select d-inline w-auto"},[...e[8]||(e[8]=[t("option",{value:"todos"},"Todos",-1),t("option",{value:"repetidos"},"Solo repetidos",-1),t("option",{value:"noRepetidos"},"Solo no repetidos",-1)])],512),[[H,y.value]])])):v("",!0),r.value.length?(c(),n("div",mt,[e[11]||(e[11]=t("h4",{class:"fw-bold text-primary mb-3 text-center text-md-start"}," üëÄ Vista previa de productos cargados ",-1)),t("div",vt,[t("table",ht,[e[10]||(e[10]=t("thead",{class:"table-primary sticky-header"},[t("tr",null,[t("th",{scope:"col",style:{"min-width":"40px"}},"C√≥digo"),t("th",{scope:"col",style:{width:"20px"}},"#"),t("th",{scope:"col",style:{"min-width":"140px"}},"Marca"),t("th",{scope:"col",style:{"min-width":"200px"}},"Nombre Producto"),t("th",{scope:"col",style:{"min-width":"140px"}},"Presentaci√≥n"),t("th",{scope:"col",style:{"min-width":"160px"}},"Principio Activo"),t("th",{scope:"col",style:{"min-width":"100px"}},"P. Farmacia"),t("th",{scope:"col",style:{"min-width":"90px"}},"PVP"),t("th",{scope:"col",style:{"min-width":"120px"}},"Promoci√≥n"),t("th",{scope:"col",style:{"min-width":"120px"}},"Descuento"),t("th",{scope:"col",style:{"min-width":"70px"}},"IVA")])],-1)),t("tbody",null,[(c(!0),n(K,null,Q(R.value,(o,d)=>(c(),n("tr",{key:d,class:X({"table-danger":o.duplicado})},[t("td",bt,a(o.Codigo),1),t("td",null,a(d+1),1),t("td",gt,a(o.Marca),1),t("td",xt,a(o.NombreProducto),1),t("td",ft,a(o.Presentacion),1),t("td",yt,a(o.PrincipioActivo),1),t("td",null,a(o.PrecioFarmacia.toFixed(2)),1),t("td",null,a(o.PVP.toFixed(2)),1),t("td",Pt,a(o.Promocion),1),t("td",null,a(o.Descuento),1),t("td",null,a(o.IVA),1)],2))),128))])])])])):v("",!0)]))])}}},At=j(wt,[["__scopeId","data-v-d6de2db4"]]);export{At as default};
