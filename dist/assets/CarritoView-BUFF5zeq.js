import{_ as ot,m as at,r as g,o as st,y as nt,b as u,d as p,e as t,i as V,w as h,v as E,s as B,t as r,F as q,h as H,z,k as $,x as lt,p as R,A as rt}from"./index-NsDpYwkK.js";import{E as dt}from"./exceljs.min-CFGRMpVv.js";import{F as J}from"./FileSaver.min-NebFnlVi.js";import{c as A,a as W}from"./utility-CvRbycmg.js";const it={class:"container px-0"},ct={key:0,class:"row mb-4"},ut={class:"col-md-3"},pt={class:"col-md-3"},mt={class:"col-md-3"},bt={class:"col-md-3"},vt={class:"col-md-3"},gt={key:1,class:"mt-4 d-flex justify-content-around flex-wrap gap-4"},ft=["disabled"],xt=["disabled"],ht={key:2,class:"mt-4"},yt={key:0,class:"export-overlay"},wt={key:1,class:"mt-4"},_t={class:"row justify-content-end"},Ct={class:"col-md-4"},Pt={class:"list-group"},Ft={class:"list-group-item d-flex justify-content-between"},kt={class:"list-group-item d-flex justify-content-between"},Nt={class:"list-group-item d-flex justify-content-between"},Vt={class:"list-group-item d-flex justify-content-between bg-light"},Et={class:"fw-bold text-success"},$t={key:2,class:"table-container",style:{"margin-bottom":"20px"}},At={class:"table table-bordered table-sm table-striped text-center align-middle tableProductos mx-auto"},Tt={"data-label":"Nombre"},St={"data-label":"Presentaci√≥n"},It={"data-label":"Principio Activo"},zt={"data-label":"Precio Farmacia"},Rt={"data-label":"Promoci√≥n"},Dt={"data-label":"Descuento"},Mt={"data-label":"Marca"},Lt={"data-label":"IVA"},Ot={"data-label":"Cantidad"},Ut=["onUpdate:modelValue","onChange"],jt={"data-label":"Cantidad a recibir"},Bt={"data-label":"Precio total producto"},qt={"data-label":"Acciones"},Ht=["onClick"],Jt={key:3,class:"mobile-cards",style:{"margin-bottom":"20px"}},Wt={class:"card-body"},Gt={class:"d-flex justify-content-between align-items-start mb-2"},Xt={class:"product-info"},Yt={class:"card-title mb-1"},Kt={class:"text-muted small"},Qt={class:"price-info"},Zt={class:"fw-bold text-success fs-5"},te={class:"text-muted small"},ee={class:"mb-1"},oe={class:"badge bg-info text-dark ms-1"},ae={key:0},se={class:"badge bg-warning text-dark ms-1"},ne={class:"quantity-controls p-2 rounded bg-light"},le={class:"d-flex align-items-center justify-content-between flex-wrap gap-2"},re={class:"d-flex align-items-center"},de=["onUpdate:modelValue","onChange"],ie={class:"ms-2"},ce={class:"badge bg-success"},ue={class:"quantity-controls p-2 rounded bg-light mt-2"},pe={class:"ms-2"},me={class:"d-grid mt-3"},be=["onClick"],ve={key:3,class:"alert alert-info mt-4"},ge={__name:"CarritoView",setup(fe){const x=at(),G=g(0),d=g([]),T=g(0),M=g(!1),w=g(!1),n=g({Nombre:"",Ciudad:"",Fecha:"",Vendedor:""}),_=g(0),C=g(0),P=g(0),F=()=>{_.value=0,C.value=0,P.value=0,d.value.forEach(a=>{const e=a.PrecioFarmacia*a.cantidad,o=Number(a.IVA);o>0?(_.value+=e,P.value+=e*(o/100)):C.value+=e}),T.value=_.value+C.value+P.value};st(()=>{const a=JSON.parse(localStorage.getItem("carrito"))||[];d.value=a,k(),F(),n.value.Fecha=new Date().toISOString().split("T")[0];const e=window.matchMedia("(max-width: 767px)"),o=s=>{M.value=s.matches!==void 0?s.matches:e.matches};o(e);try{e.addEventListener("change",o)}catch{e.addListener(o)}nt(()=>{try{e.removeEventListener("change",o)}catch{e.removeListener(o)}})});const k=()=>{T.value=d.value.reduce((a,e)=>{const o=e.IVA>0?e.IVA:0,s=e.PrecioFarmacia*e.cantidad*(1+o/100);return a+s},0)},L=(a,e,o)=>{d.value[a].cantidad<1&&(d.value[a].cantidad=1),localStorage.setItem("carrito",JSON.stringify(d.value)),k(),F(),G.value=A(e,o).total},O=a=>{try{R.confirm("Confirmar eliminaci√≥n","¬øDesea eliminar este producto del carrito?",function(){d.value.splice(a,1),localStorage.setItem("carrito",JSON.stringify(d.value)),k(),F(),x.success("Producto eliminado")},function(){})}catch{d.value.splice(a,1),localStorage.setItem("carrito",JSON.stringify(d.value)),k(),F()}},X=async()=>{const e=["Nombre","Ciudad","Fecha","Vendedor","Tipo"].filter(o=>!n.value[o]);if(e.length){R.alert(`‚ùå Faltan campos obligatorios: ${e.join(", ")}`);return}w.value=!0;try{const o=new dt.Workbook,s=o.addWorksheet(n.value.Tipo);s.addRow([`Datos ${n.value.Tipo}`]),s.addRow(["Nombre",n.value.Nombre]),s.addRow(["Ciudad",n.value.Ciudad]),s.addRow(["Fecha",n.value.Fecha]),s.addRow(["Vendedor",n.value.Vendedor]),s.addRow(["Tipo",n.value.Tipo]),s.addRow([]);let c=[],m=[];n.value.Tipo==="Pedido"&&(c=["Cantidad","Promoci√≥n","Nombre Producto","Lote","Fecha de Vencimiento"],m=d.value.map(l=>{const{promo:b,total:y,detalle:i,cantidad:v}=A(l.cantidad,l.Promocion);return[l.cantidad,b,l.NombreProducto,"",""]})),n.value.Tipo==="Proforma"&&(c=["Cantidad","Promoci√≥n","Nombre Producto","Marca","Precio Farmacia","Total"],m=d.value.map(l=>{const b=l.PrecioFarmacia*l.cantidad;return[l.cantidad,A(l.cantidad,l.Promocion).promo,l.NombreProducto,l.Marca,l.PrecioFarmacia,b.toFixed(2)]}));const N=s.addRow(c);if(N.height=30,N.eachCell(l=>{l.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFCCE5FF"}},l.font={bold:!0,size:12,color:{argb:"FF000000"}},l.alignment={horizontal:"center",vertical:"middle",wrapText:!0},l.border={top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}}}),n.value.Tipo==="Pedido"&&(s.getColumn(1).width=15,s.getColumn(2).width=15,s.getColumn(3).width=35,s.getColumn(4).width=40,s.getColumn(5).width=40),n.value.Tipo==="Proforma"&&(s.getColumn(1).width=15,s.getColumn(2).width=15,s.getColumn(3).width=35,s.getColumn(4).width=35,s.getColumn(5).width=15,s.getColumn(6).width=20),m.forEach(l=>{const b=s.addRow(l);b.height=55,b.eachCell(y=>{y.border={top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}},y.alignment={vertical:"middle",horizontal:"center",wrapText:!0}})}),n.value.Tipo==="Proforma"){s.addRow([]);const l=s.addRow(["","","","","Subtotal 15%:",`$ ${_.value.toFixed(2)}`]),b=s.addRow(["","","","","Subtotal 0%:",`$ ${C.value.toFixed(2)}`]),y=s.addRow(["","","","","IVA 15%:",`$ ${P.value.toFixed(2)}`]),i=s.addRow(["","","","","VALOR TOTAL:",`$ ${T.value.toFixed(2)}`]);[l,b,y,i].forEach(v=>{v.eachCell(f=>{f.value?.toString().trim()&&(f.border={top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}},f.alignment={vertical:"middle",horizontal:"center",wrapText:!0},f.font={bold:!0})})})}const S=await o.xlsx.writeBuffer(),I=`${n.value.Tipo}_Cliente_${n.value.Nombre}_ciudad_${n.value.Ciudad}_Cliente_${n.value.Fecha}.xlsx`;J.saveAs(new Blob([S]),I),x.success("Excel generado correctamente")}catch(o){console.error("Error generando Excel:",o),x.error("Ocurri√≥ un error al generar el Excel")}finally{w.value=!1}},Y=async()=>{try{R.confirm("Vaciar carrito","¬øEst√° seguro que desea vaciar todo el carrito? Esta acci√≥n no se puede deshacer.",function(){localStorage.removeItem("carrito"),d.value=[],k(),F(),x.success("Carrito vaciado")},function(){})}catch{localStorage.removeItem("carrito"),d.value=[]}},K=async()=>{if(!n.value.Nombre.trim()){R.alert("Campo obligatorio","‚ùå Por favor, ingrese el nombre del cliente antes de exportar");return}w.value=!0;let a=null;try{const e=new Date().toISOString().split("T")[0],o=n.value.Nombre.trim().replace(/\s+/g,"_"),s=600;a=document.createElement("div"),a.style.width=s+"px",a.style.padding="5px",a.style.backgroundColor="white",a.style.boxSizing="border-box",a.style.fontFamily="'Segoe UI', Roboto, Arial, sans-serif",a.style.margin="0 auto",a.style.color="#222",a.style.border="1px solid #e6e6e6",a.style.fontSize="14px",a.style.lineHeight="1.25",a.style.setProperty("-webkit-font-smoothing","antialiased"),a.style.setProperty("text-rendering","optimizeLegibility");const c=document.createElement("h2");c.textContent=`Lista productos MH - ${n.value.Nombre} - ${e}`,c.style.textAlign="center",c.style.margin="10px 0 12px 0",c.style.fontSize="14px",c.style.color="#333",a.appendChild(c);const m=document.createElement("table");m.style.borderCollapse="collapse",m.style.width="100%",m.style.tableLayout="fixed";const N=document.createElement("colgroup");[40,25,30,15,25,20].forEach(i=>{const v=document.createElement("col");v.style.width=i+"%",N.appendChild(v)}),m.appendChild(N);const S=document.createElement("thead");S.innerHTML=`
      <tr style="background-color: #4CAF50; color: white;">
        <th style="padding: 6px; border: 1px solid #ddd; font-size:12px; text-align:center;">Producto</th>
        <th style="padding: 6px; border: 1px solid #ddd; font-size:12px; text-align:center;">Marca</th>
        <th style="padding: 6px; border: 1px solid #ddd; font-size:12px; text-align:center;">Presentaci√≥n</th>
        <th style="padding: 6px; border: 1px solid #ddd; font-size:12px; text-align:center;">Precio</th>
        <th style="padding: 6px; border: 1px solid #ddd; font-size:12px; text-align:center;">Promoci√≥n</th>
        <th style="padding: 6px; border: 1px solid #ddd; font-size:12px; text-align:center;">Descuento %</th>
      </tr>
    `,m.appendChild(S);const I=document.createElement("tbody");if(d.value.forEach((i,v)=>{const f=document.createElement("tr");f.style.backgroundColor=v%2===0?"#f9f9f9":"white";const U=i.NombreProducto||"",Q=i.Marca||"",Z=i.Presentacion||"",tt=i.PrecioFarmacia!==void 0&&i.PrecioFarmacia!==null?"$"+Number(i.PrecioFarmacia).toFixed(2):"N/D",et=i.Promocion||"";let j="";if(i.Descuento!==void 0&&i.Descuento!==null){const D=Number(i.Descuento);!isNaN(D)&&D!==0&&(j=String(D)+" %")}f.innerHTML=`
  <td style="padding: 3px; border: 1px solid #ddd; font-size:12px; text-align:left; word-break:break-word;">${U}</td>
  <td style="padding: 3px; border: 1px solid #ddd; font-size:12px; text-align:center; word-break:break-word;">${Q}</td>
  <td style="padding: 3px; border: 1px solid #ddd; font-size:12px; text-align:center; word-break:break-word;">${Z}</td>
  <td style="padding: 3px; border: 1px solid #ddd; font-size:12px; text-align:center;">${tt}</td>
  <td style="padding: 3px; border: 1px solid #ddd; font-size:12px; text-align:center; word-break:break-word;">${et}</td>
  <td style="padding: 3px; border: 1px solid #ddd; font-size:12px; text-align:center;">${j}</td>
`,I.appendChild(f)}),m.appendChild(I),a.appendChild(m),a.style.position="fixed",a.style.left="50%",a.style.top="-9999px",a.style.transform="translateX(-50%)",document.body.appendChild(a),await new Promise(i=>requestAnimationFrame(()=>setTimeout(i,80))),document.fonts&&document.fonts.ready)try{await document.fonts.ready}catch{}const l=(await rt(async()=>{const{default:i}=await import("./html2canvas.esm-B0tyYwQk.js");return{default:i}},[])).default,b=Math.min(3,window.devicePixelRatio||1);(await l(a,{backgroundColor:"white",scale:b,useCORS:!0,logging:!1})).toBlob(i=>{if(i){const v=`lista_precios_MH_cliente_${o}_${e}.png`;J.saveAs(i,v),x.success("Imagen descargada correctamente")}else x.error("No se pudo generar la imagen")},"image/png")}catch(e){console.error("Error generando imagen:",e),x.error("No se pudo generar la imagen. Intente nuevamente o use Exportar Excel.")}finally{try{a&&document.body.contains(a)&&document.body.removeChild(a)}catch{}w.value=!1}};return(a,e)=>(p(),u("div",it,[e[28]||(e[28]=t("h2",{class:"text-center mb-4"},"üõí Carrito de Compras",-1)),d.value.length?(p(),u("div",ct,[t("div",ut,[e[5]||(e[5]=t("label",{class:"form-label"},"Nombre cliente",-1)),h(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>n.value.Nombre=o),type:"text",class:"form-control"},null,512),[[E,n.value.Nombre]])]),t("div",pt,[e[6]||(e[6]=t("label",{class:"form-label"},"Ciudad",-1)),h(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>n.value.Ciudad=o),type:"text",class:"form-control"},null,512),[[E,n.value.Ciudad]])]),t("div",mt,[e[7]||(e[7]=t("label",{class:"form-label"},"Fecha",-1)),h(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>n.value.Fecha=o),type:"date",readonly:"",disabled:"",class:"form-control"},null,512),[[E,n.value.Fecha]])]),t("div",bt,[e[9]||(e[9]=t("label",{class:"form-label"},"Vendedor",-1)),h(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>n.value.Vendedor=o),class:"form-select"},[...e[8]||(e[8]=[t("option",{value:"",disabled:"",selected:""},"Seleccione",-1),t("option",{value:"Diana Benalc√°zar"},"Diana Benalc√°zar",-1)])],512),[[B,n.value.Vendedor]])]),t("div",vt,[e[11]||(e[11]=t("label",{class:"form-label"},"Tipo de documento",-1)),h(t("select",{"onUpdate:modelValue":e[4]||(e[4]=o=>n.value.Tipo=o),class:"form-select"},[...e[10]||(e[10]=[t("option",{value:"",disabled:"",selected:""},"Seleccione",-1),t("option",{value:"Pedido"},"Pedido",-1),t("option",{value:"Proforma"},"Proforma",-1)])],512),[[B,n.value.Tipo]])])])):V("",!0),e[29]||(e[29]=t("hr",{style:{border:"solid 1px silver"}},null,-1)),d.value.length?(p(),u("div",gt,[t("button",{onClick:Y,class:"btn btn-warning"}," Vaciar carrito "),t("button",{class:"btn btn-primary",onClick:X,disabled:!d.value.length}," Exportar Excel ",8,ft),t("button",{class:"btn btn-success",onClick:K,disabled:!d.value.length}," Exportar Imagen promociones ",8,xt)])):V("",!0),e[30]||(e[30]=t("hr",{style:{border:"solid 1px silver"}},null,-1)),d.value.length?(p(),u("div",ht,[w.value?(p(),u("div",yt,[...e[12]||(e[12]=[t("div",{class:"export-spinner","aria-hidden":"true"},null,-1),t("div",{class:"export-text"},"Generando archivo, por favor espere...",-1)])])):V("",!0),d.value.length?(p(),u("div",wt,[t("div",_t,[t("div",Ct,[t("ul",Pt,[t("li",Ft,[e[13]||(e[13]=t("strong",null,"Subtotal 15%:",-1)),t("span",null,"$ "+r(_.value.toFixed(2)),1)]),t("li",kt,[e[14]||(e[14]=t("strong",null,"Subtotal 0%:",-1)),t("span",null,"$ "+r(C.value.toFixed(2)),1)]),t("li",Nt,[e[15]||(e[15]=t("strong",null,"IVA 15%:",-1)),t("span",null,"$ "+r(P.value.toFixed(2)),1)]),t("li",Vt,[e[16]||(e[16]=t("strong",null,"Total:",-1)),t("span",Et,"$ "+r(T.value.toFixed(2)),1)])])])])])):V("",!0),e[27]||(e[27]=t("hr",{style:{border:"solid 1px silver"}},null,-1)),M.value?(p(),u("div",Jt,[(p(!0),u(q,null,H(d.value,(o,s)=>(p(),u("div",{key:o.id,class:"card mb-3 mobile-card"},[t("div",Wt,[t("div",Gt,[t("div",Xt,[t("h5",Yt,r(o.NombreProducto),1),t("div",Kt,[t("div",null,[e[18]||(e[18]=t("strong",null,"Marca:",-1)),$(" "+r(o.Marca),1)]),t("div",null,[e[19]||(e[19]=t("strong",null,"Presentaci√≥n:",-1)),$(" "+r(o.Presentacion),1)]),t("div",null,[e[20]||(e[20]=t("strong",null,"P. Activo:",-1)),$(" "+r(o.PrincipioActivo||"-"),1)])])]),t("div",Qt,[t("div",Zt," $ "+r(Number(o.PrecioFarmacia).toFixed(2)),1),t("div",te," IVA: "+r(o.IVA>0?o.IVA+"%":"No aplica"),1)])]),t("div",{class:lt(["promo-info p-2 mb-2 rounded",o.Promocion?"bg-light":""])},[t("div",ee,[e[21]||(e[21]=t("strong",{class:"text-primary"},"Promoci√≥n:",-1)),t("span",oe,r(o.Promocion||"Sin promoci√≥n"),1)]),o.Descuento&&Number(o.Descuento)!==0?(p(),u("div",ae,[e[22]||(e[22]=t("strong",{class:"text-primary"},"Descuento:",-1)),t("span",se,r(o.Descuento)+"%",1)])):V("",!0)],2),t("div",ne,[t("div",le,[t("div",re,[e[23]||(e[23]=t("label",{class:"me-2 fw-bold mb-0"},"Cantidad:",-1)),h(t("input",{type:"number",min:"0","onUpdate:modelValue":c=>o.cantidad=c,onChange:c=>L(s,o.cantidad,o.Promocion),class:"form-control",style:{width:"80px"}},null,40,de),[[E,o.cantidad,void 0,{number:!0}]])]),t("div",ie,[e[24]||(e[24]=t("strong",null,"A recibir: ",-1)),t("span",ce,r(z(A)(o.cantidad,o.Promocion).total),1)])])]),t("div",ue,[t("div",pe,[e[25]||(e[25]=t("strong",null,"Precio total: ",-1)),$(" $ "+r(z(W)(o.cantidad,o.PrecioFarmacia).toFixed(2)),1)])]),t("div",me,[t("button",{class:"btn btn-outline-danger",onClick:c=>O(s)},[...e[26]||(e[26]=[t("i",{class:"fas fa-trash-alt me-2"},null,-1),$("Eliminar producto ",-1)])],8,be)])])]))),128))])):(p(),u("div",$t,[t("table",At,[e[17]||(e[17]=t("thead",null,[t("tr",null,[t("th",{class:"text-wrap fs-6 text"},"Nombre"),t("th",{class:"text-wrap fs-6 text"},"Presentaci√≥n"),t("th",{class:"text-wrap fs-6 text"},"Principio Activo"),t("th",{class:"text-wrap fs-6 text"},"P FARMACIA"),t("th",{class:"text-wrap fs-6 text"},"Promoci√≥n"),t("th",{class:"text-wrap fs-6 text"},"Descuento"),t("th",{class:"text-wrap fs-6 text"},"Marca"),t("th",{class:"text-wrap fs-6 text"},"IVA"),t("th",{class:"text-wrap fs-6 text"},"Cantidad"),t("th",{class:"text-wrap fs-6 text"},"A recibir"),t("th",{class:"text-wrap fs-6 text"},"Precio total producto"),t("th",{class:"text-wrap fs-6 text"},"Acciones")])],-1)),t("tbody",null,[(p(!0),u(q,null,H(d.value,(o,s)=>(p(),u("tr",{key:o.id},[t("td",Tt,r(o.NombreProducto),1),t("td",St,r(o.Presentacion),1),t("td",It,r(o.PrincipioActivo),1),t("td",zt,"$ "+r(o.PrecioFarmacia),1),t("td",Rt,r(o.Promocion),1),t("td",Dt,r(o.Descuento!==void 0&&o.Descuento!==null&&Number(o.Descuento)!==0?o.Descuento:""),1),t("td",Mt,r(o.Marca),1),t("td",Lt,r(o.IVA>0?o.IVA+"%":"No aplica"),1),t("td",Ot,[h(t("input",{type:"number",min:"0","onUpdate:modelValue":c=>o.cantidad=c,onChange:c=>L(s,o.cantidad,o.Promocion),class:"form-control form-control-sm",style:{width:"80px"}},null,40,Ut),[[E,o.cantidad,void 0,{number:!0}]])]),t("td",jt,r(z(A)(o.cantidad,o.Promocion).total),1),t("td",Bt," $ "+r(z(W)(o.cantidad,o.PrecioFarmacia).toFixed(2)),1),t("td",qt,[t("button",{class:"btn btn-danger btn-sm",onClick:c=>O(s)}," Eliminar ",8,Ht)])]))),128))])])]))])):(p(),u("div",ve,"El carrito est√° vac√≠o."))]))}},_e=ot(ge,[["__scopeId","data-v-a91aba44"]]);export{_e as default};
