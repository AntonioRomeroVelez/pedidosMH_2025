import{r as S,u as $}from"./xlsx-hAyDQTdp.js";import{a as m}from"./alertify-DPht8m50.js";import{_ as D,r as p,b as s,d as l,n as M,e as a,j as g,h as V,k as L,a as R,F as _,i as A,m as w,f as x,t as o,p as B}from"./index-Bfnw7Xza.js";import{L as H}from"./LoadingComponent-CymgpyEI.js";const T={class:"cargar-excel",style:{"margin-top":"90px"}},G={key:0},z={key:1},J={key:0,class:"mt-3"},O={key:1,class:"table-responsive mt-4"},U={class:"table table-bordered table-sm formato-tabla"},q={__name:"CargarExcel",setup(K){const h=p(!1),u=p([]),d=p([]),k=w(),E=b=>{h.value=!0;const e=b.target.files[0];if(!e){h.value=!1;return}const v=new FileReader;v.onload=t=>{try{const i=new Uint8Array(t.target.result),y=S(i,{type:"array"});d.value=[];let N=[];y.SheetNames.forEach((P,j)=>{const C=y.Sheets[P];$.sheet_to_json(C).forEach((r,f)=>{const c={ID:`id-${f}-${r.NombreProducto.split(" ")[0]}-${Math.random().toString(36).substr(2,5)}`,NombreProducto:r.NombreProducto??"",Presentacion:r.Presentacion??"",PrincipioActivo:r.PrincipioActivo??"",PrecioFarmacia:parseFloat(r.PrecioFarmacia??""),PVP:parseFloat(r.PVP??""),Promocion:r.Promocion??"",Descuento:parseInt(r.Descuento??0),Marca:r.Marca??"",IVA:parseInt(r.IVA??0)},n=[];c.NombreProducto||n.push("Nombre vac√≠o"),c.Presentacion||n.push("Presentaci√≥n vac√≠a"),c.PrincipioActivo||n.push("Principio activo vac√≠o"),isNaN(c.PrecioFarmacia)&&n.push("Precio farmacia inv√°lido"),isNaN(c.PVP)&&n.push("PVP inv√°lido"),c.Marca||n.push("Marca vac√≠a"),isNaN(c.IVA)&&n.push("IVA inv√°lido"),n.length>0&&(d.value.push({hoja:P,fila:f+2,errores:n,id:`${j}${f}`}),console.log(`Hoja: ${P}, Fila ${f+2}`,r)),N.push(c)})}),u.value=N,d.value.length>0?m.error("‚ùå Hay errores en el archivo. Revisa las filas marcadas."):m.success("‚úÖ Archivo cargado correctamente")}catch(i){m.error("‚ùå Error al procesar el archivo."),console.error("Error al leer Excel:",i)}finally{h.value=!1}},v.readAsArrayBuffer(e)},F=b=>{const e=u.value[b];return d.value.some(v=>v.id===e.ID)},I=()=>{if(d.value.length>0){m.error("‚ùå No se puede guardar. Corrige los errores primero.");return}localStorage.removeItem("ListaProductos"),localStorage.setItem("ListaProductos",JSON.stringify(u.value)),m.success("‚úÖ Productos guardados en memoria"),setTimeout(()=>{k.push("/Productos")},1e3)};return(b,e)=>{const v=R("RouterLink");return l(),s("div",T,[e[4]||(e[4]=M('<h2 data-v-ab60572f>üì• Cargar productos desde Excel</h2><p data-v-ab60572f>üìù El archivo debe tener las siguientes columnas:</p><div class="table-responsive" data-v-ab60572f><table class="table table-bordered formato-tabla" data-v-ab60572f><thead data-v-ab60572f><tr data-v-ab60572f><th data-v-ab60572f>NombreProducto</th><th data-v-ab60572f>Presentacion</th><th data-v-ab60572f>PrincipioActivo</th><th data-v-ab60572f>PrecioFarmacia</th><th data-v-ab60572f>PVP</th><th data-v-ab60572f>Promocion</th><th data-v-ab60572f>Descuento</th><th data-v-ab60572f>Marca</th><th data-v-ab60572f>IVA</th></tr></thead><tbody data-v-ab60572f><tr data-v-ab60572f><td data-v-ab60572f>Paracetamol 500mg</td><td data-v-ab60572f>Caja x 10</td><td data-v-ab60572f>Paracetamol</td><td data-v-ab60572f>1.50</td><td data-v-ab60572f>2.00</td><td data-v-ab60572f>2x1</td><td data-v-ab60572f>10</td><td data-v-ab60572f>Genfar</td><td data-v-ab60572f>15</td></tr></tbody></table></div>',3)),a("input",{type:"file",onChange:E,accept:".xlsx, .xls",class:"form-control my-3"},null,32),a("div",null,[u.value.length?(l(),s("button",{key:0,onClick:I,class:"btn btn-success m-5"}," Guardar productos en memoria ")):g("",!0),V(v,{class:"btn btn-success px-2 sm",to:"/Productos"},{default:L(()=>[...e[0]||(e[0]=[x(" Atr√°s ",-1)])]),_:1})]),h.value?(l(),s("div",G,[V(H)])):(l(),s("div",z,[d.value.length?(l(),s("div",J,[e[1]||(e[1]=a("h5",{class:"text-danger"},"‚ùå Errores detectados:",-1)),a("ul",null,[(l(!0),s(_,null,A(d.value,t=>(l(),s("li",{key:`${t.hoja}-${t.fila}`},[a("strong",null,"Hoja "+o(t.hoja)+", Fila "+o(t.fila)+":",1),x(" "+o(t.errores.join(", ")),1)]))),128))])])):g("",!0),u.value.length?(l(),s("div",O,[e[3]||(e[3]=a("h4",null,"üëÄ Vista previa de productos cargados",-1)),a("table",U,[e[2]||(e[2]=a("thead",null,[a("tr",null,[a("th",null,"#"),a("th",null,"NombreProducto"),a("th",null,"Presentacion"),a("th",null,"PrincipioActivo"),a("th",null,"PrecioFarmacia"),a("th",null,"PVP"),a("th",null,"Promocion"),a("th",null,"Descuento"),a("th",null,"Marca"),a("th",null,"IVA")])],-1)),a("tbody",null,[(l(!0),s(_,null,A(u.value,(t,i)=>(l(),s("tr",{key:i,class:B({"table-danger":F(i)})},[a("td",null,o(i+1),1),a("td",null,o(t.NombreProducto),1),a("td",null,o(t.Presentacion),1),a("td",null,o(t.PrincipioActivo),1),a("td",null,o(t.PrecioFarmacia),1),a("td",null,o(t.PVP),1),a("td",null,o(t.Promocion),1),a("td",null,o(t.Descuento),1),a("td",null,o(t.Marca),1),a("td",null,o(t.IVA),1)],2))),128))])])])):g("",!0)]))])}}},aa=D(q,[["__scopeId","data-v-ab60572f"]]);export{aa as default};
