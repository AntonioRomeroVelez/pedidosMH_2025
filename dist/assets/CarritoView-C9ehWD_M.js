import{_ as et,m as ot,r as f,o as at,y as st,b as u,d as p,e as t,i as V,w as h,v as E,s as j,t as i,F as B,h as H,z as J,k as I,x as nt,p as z,A as lt}from"./index-BYMz3318.js";import{E as rt}from"./exceljs.min-DjIT7sF6.js";import{F as q}from"./FileSaver.min-Bvn_O8ts.js";import{c as A}from"./utility-BAyQKch2.js";const dt={class:"container px-0"},it={key:0,class:"row mb-4"},ct={class:"col-md-3"},ut={class:"col-md-3"},pt={class:"col-md-3"},mt={class:"col-md-3"},bt={class:"col-md-3"},vt={key:1,class:"mt-4 d-flex justify-content-around flex-wrap gap-4"},ft=["disabled"],gt=["disabled"],xt={key:2,class:"mt-4"},ht={key:0,class:"export-overlay"},yt={key:1,class:"mt-4"},wt={class:"row justify-content-end"},_t={class:"col-md-4"},Ct={class:"list-group"},Pt={class:"list-group-item d-flex justify-content-between"},Ft={class:"list-group-item d-flex justify-content-between"},kt={class:"list-group-item d-flex justify-content-between"},Nt={class:"list-group-item d-flex justify-content-between bg-light"},Vt={class:"fw-bold text-success"},Et={key:2,class:"table-container"},At={class:"table table-bordered table-sm table-striped text-center align-middle tableProductos mx-auto"},$t={"data-label":"Nombre"},Tt={"data-label":"Presentaci√≥n"},St={"data-label":"Principio Activo"},It={"data-label":"Precio Farmacia"},zt={"data-label":"Promoci√≥n"},Rt={"data-label":"Descuento"},Dt={"data-label":"Marca"},Mt={"data-label":"IVA"},Lt={"data-label":"Cantidad"},Ot=["onUpdate:modelValue","onChange"],Ut={"data-label":"Cantidad a recibir"},jt={"data-label":"Acciones"},Bt=["onClick"],Ht={key:3,class:"mobile-cards"},Jt={class:"card-body"},qt={class:"d-flex justify-content-between align-items-start mb-2"},Wt={class:"product-info"},Gt={class:"card-title mb-1"},Xt={class:"text-muted small"},Yt={class:"price-info"},Kt={class:"fw-bold text-success fs-5"},Qt={class:"text-muted small"},Zt={class:"mb-1"},te={class:"badge bg-info text-dark ms-1"},ee={key:0},oe={class:"badge bg-warning text-dark ms-1"},ae={class:"quantity-controls p-2 rounded bg-light"},se={class:"d-flex align-items-center justify-content-between flex-wrap gap-2"},ne={class:"d-flex align-items-center"},le=["onUpdate:modelValue","onChange"],re={class:"ms-2"},de={class:"badge bg-success"},ie={class:"d-grid mt-3"},ce=["onClick"],ue={key:3,class:"alert alert-info mt-4"},pe={__name:"CarritoView",setup(me){const x=ot(),W=f(0),r=f([]),$=f(0),D=f(!1),w=f(!1),n=f({Nombre:"",Ciudad:"",Fecha:"",Vendedor:""}),_=f(0),C=f(0),P=f(0),F=()=>{_.value=0,C.value=0,P.value=0,r.value.forEach(a=>{const e=a.PrecioFarmacia*a.cantidad,o=Number(a.IVA);o>0?(_.value+=e,P.value+=e*(o/100)):C.value+=e}),$.value=_.value+C.value+P.value};at(()=>{const a=JSON.parse(localStorage.getItem("carrito"))||[];r.value=a,k(),F(),n.value.Fecha=new Date().toISOString().split("T")[0];const e=window.matchMedia("(max-width: 767px)"),o=s=>{D.value=s.matches!==void 0?s.matches:e.matches};o(e);try{e.addEventListener("change",o)}catch{e.addListener(o)}st(()=>{try{e.removeEventListener("change",o)}catch{e.removeListener(o)}})});const k=()=>{$.value=r.value.reduce((a,e)=>{const o=e.IVA>0?e.IVA:0,s=e.PrecioFarmacia*e.cantidad*(1+o/100);return a+s},0)},M=(a,e,o)=>{r.value[a].cantidad<1&&(r.value[a].cantidad=1),localStorage.setItem("carrito",JSON.stringify(r.value)),k(),F(),W.value=A(e,o).total},L=a=>{try{z.confirm("Confirmar eliminaci√≥n","¬øDesea eliminar este producto del carrito?",function(){r.value.splice(a,1),localStorage.setItem("carrito",JSON.stringify(r.value)),k(),F(),x.success("Producto eliminado")},function(){})}catch{r.value.splice(a,1),localStorage.setItem("carrito",JSON.stringify(r.value)),k(),F()}},G=async()=>{const e=["Nombre","Ciudad","Fecha","Vendedor","Tipo"].filter(o=>!n.value[o]);if(e.length){z.alert(`‚ùå Faltan campos obligatorios: ${e.join(", ")}`);return}w.value=!0;try{const o=new rt.Workbook,s=o.addWorksheet(n.value.Tipo);s.addRow([`Datos ${n.value.Tipo}`]),s.addRow(["Nombre",n.value.Nombre]),s.addRow(["Ciudad",n.value.Ciudad]),s.addRow(["Fecha",n.value.Fecha]),s.addRow(["Vendedor",n.value.Vendedor]),s.addRow(["Tipo",n.value.Tipo]),s.addRow([]);let c=[],m=[];n.value.Tipo==="Pedido"&&(c=["Cantidad","Promoci√≥n","Nombre Producto","Lote","Fecha de Vencimiento"],m=r.value.map(l=>{const{promo:b,total:y,detalle:d,cantidad:v}=A(l.cantidad,l.Promocion);return[l.cantidad,b,l.NombreProducto,"",""]})),n.value.Tipo==="Proforma"&&(c=["Cantidad","Promoci√≥n","Nombre Producto","Marca","Precio Farmacia","Total"],m=r.value.map(l=>{const b=l.PrecioFarmacia*l.cantidad;return[l.cantidad,A(l.cantidad,l.Promocion).promo,l.NombreProducto,l.Marca,l.PrecioFarmacia,b.toFixed(2)]}));const N=s.addRow(c);if(N.height=30,N.eachCell(l=>{l.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFCCE5FF"}},l.font={bold:!0,size:12,color:{argb:"FF000000"}},l.alignment={horizontal:"center",vertical:"middle",wrapText:!0},l.border={top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}}}),n.value.Tipo==="Pedido"&&(s.getColumn(1).width=15,s.getColumn(2).width=15,s.getColumn(3).width=35,s.getColumn(4).width=40,s.getColumn(5).width=40),n.value.Tipo==="Proforma"&&(s.getColumn(1).width=15,s.getColumn(2).width=15,s.getColumn(3).width=35,s.getColumn(4).width=35,s.getColumn(5).width=15,s.getColumn(6).width=20),m.forEach(l=>{const b=s.addRow(l);b.height=55,b.eachCell(y=>{y.border={top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}},y.alignment={vertical:"middle",horizontal:"center",wrapText:!0}})}),n.value.Tipo==="Proforma"){s.addRow([]);const l=s.addRow(["","","","","Subtotal 15%:",`$ ${_.value.toFixed(2)}`]),b=s.addRow(["","","","","Subtotal 0%:",`$ ${C.value.toFixed(2)}`]),y=s.addRow(["","","","","IVA 15%:",`$ ${P.value.toFixed(2)}`]),d=s.addRow(["","","","","VALOR TOTAL:",`$ ${$.value.toFixed(2)}`]);[l,b,y,d].forEach(v=>{v.eachCell(g=>{g.value?.toString().trim()&&(g.border={top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}},g.alignment={vertical:"middle",horizontal:"center",wrapText:!0},g.font={bold:!0})})})}const T=await o.xlsx.writeBuffer(),S=`${n.value.Tipo}_Cliente_${n.value.Nombre}_ciudad_${n.value.Ciudad}_Cliente_${n.value.Fecha}.xlsx`;q.saveAs(new Blob([T]),S),x.success("Excel generado correctamente")}catch(o){console.error("Error generando Excel:",o),x.error("Ocurri√≥ un error al generar el Excel")}finally{w.value=!1}},X=async()=>{try{z.confirm("Vaciar carrito","¬øEst√° seguro que desea vaciar todo el carrito? Esta acci√≥n no se puede deshacer.",function(){localStorage.removeItem("carrito"),r.value=[],k(),F(),x.success("Carrito vaciado")},function(){})}catch{localStorage.removeItem("carrito"),r.value=[]}},Y=async()=>{if(!n.value.Nombre.trim()){z.alert("Campo obligatorio","‚ùå Por favor, ingrese el nombre del cliente antes de exportar");return}w.value=!0;let a=null;try{const e=new Date().toISOString().split("T")[0],o=n.value.Nombre.trim().replace(/\s+/g,"_"),s=600;a=document.createElement("div"),a.style.width=s+"px",a.style.padding="5px",a.style.backgroundColor="white",a.style.boxSizing="border-box",a.style.fontFamily="'Segoe UI', Roboto, Arial, sans-serif",a.style.margin="0 auto",a.style.color="#222",a.style.border="1px solid #e6e6e6",a.style.fontSize="14px",a.style.lineHeight="1.25",a.style.setProperty("-webkit-font-smoothing","antialiased"),a.style.setProperty("text-rendering","optimizeLegibility");const c=document.createElement("h2");c.textContent=`Lista productos MH - ${n.value.Nombre} - ${e}`,c.style.textAlign="center",c.style.margin="10px 0 12px 0",c.style.fontSize="14px",c.style.color="#333",a.appendChild(c);const m=document.createElement("table");m.style.borderCollapse="collapse",m.style.width="100%",m.style.tableLayout="fixed";const N=document.createElement("colgroup");[40,25,30,15,25,20].forEach(d=>{const v=document.createElement("col");v.style.width=d+"%",N.appendChild(v)}),m.appendChild(N);const T=document.createElement("thead");T.innerHTML=`
      <tr style="background-color: #4CAF50; color: white;">
        <th style="padding: 6px; border: 1px solid #ddd; font-size:12px; text-align:center;">Producto</th>
        <th style="padding: 6px; border: 1px solid #ddd; font-size:12px; text-align:center;">Marca</th>
        <th style="padding: 6px; border: 1px solid #ddd; font-size:12px; text-align:center;">Presentaci√≥n</th>
        <th style="padding: 6px; border: 1px solid #ddd; font-size:12px; text-align:center;">Precio</th>
        <th style="padding: 6px; border: 1px solid #ddd; font-size:12px; text-align:center;">Promoci√≥n</th>
        <th style="padding: 6px; border: 1px solid #ddd; font-size:12px; text-align:center;">Descuento %</th>
      </tr>
    `,m.appendChild(T);const S=document.createElement("tbody");if(r.value.forEach((d,v)=>{const g=document.createElement("tr");g.style.backgroundColor=v%2===0?"#f9f9f9":"white";const O=d.NombreProducto||"",K=d.Marca||"",Q=d.Presentacion||"",Z=d.PrecioFarmacia!==void 0&&d.PrecioFarmacia!==null?"$"+Number(d.PrecioFarmacia).toFixed(2):"N/D",tt=d.Promocion||"";let U="";if(d.Descuento!==void 0&&d.Descuento!==null){const R=Number(d.Descuento);!isNaN(R)&&R!==0&&(U=String(R)+" %")}g.innerHTML=`
  <td style="padding: 3px; border: 1px solid #ddd; font-size:12px; text-align:left; word-break:break-word;">${O}</td>
  <td style="padding: 3px; border: 1px solid #ddd; font-size:12px; text-align:center; word-break:break-word;">${K}</td>
  <td style="padding: 3px; border: 1px solid #ddd; font-size:12px; text-align:center; word-break:break-word;">${Q}</td>
  <td style="padding: 3px; border: 1px solid #ddd; font-size:12px; text-align:center;">${Z}</td>
  <td style="padding: 3px; border: 1px solid #ddd; font-size:12px; text-align:center; word-break:break-word;">${tt}</td>
  <td style="padding: 3px; border: 1px solid #ddd; font-size:12px; text-align:center;">${U}</td>
`,S.appendChild(g)}),m.appendChild(S),a.appendChild(m),a.style.position="fixed",a.style.left="50%",a.style.top="-9999px",a.style.transform="translateX(-50%)",document.body.appendChild(a),await new Promise(d=>requestAnimationFrame(()=>setTimeout(d,80))),document.fonts&&document.fonts.ready)try{await document.fonts.ready}catch{}const l=(await lt(async()=>{const{default:d}=await import("./html2canvas.esm-B0tyYwQk.js");return{default:d}},[])).default,b=Math.min(3,window.devicePixelRatio||1);(await l(a,{backgroundColor:"white",scale:b,useCORS:!0,logging:!1})).toBlob(d=>{if(d){const v=`lista_precios_MH_cliente_${o}_${e}.png`;q.saveAs(d,v),x.success("Imagen descargada correctamente")}else x.error("No se pudo generar la imagen")},"image/png")}catch(e){console.error("Error generando imagen:",e),x.error("No se pudo generar la imagen. Intente nuevamente o use Exportar Excel.")}finally{try{a&&document.body.contains(a)&&document.body.removeChild(a)}catch{}w.value=!1}};return(a,e)=>(p(),u("div",dt,[e[27]||(e[27]=t("h2",{class:"text-center mb-4"},"üõí Carrito de Compras",-1)),r.value.length?(p(),u("div",it,[t("div",ct,[e[5]||(e[5]=t("label",{class:"form-label"},"Nombre cliente",-1)),h(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>n.value.Nombre=o),type:"text",class:"form-control"},null,512),[[E,n.value.Nombre]])]),t("div",ut,[e[6]||(e[6]=t("label",{class:"form-label"},"Ciudad",-1)),h(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>n.value.Ciudad=o),type:"text",class:"form-control"},null,512),[[E,n.value.Ciudad]])]),t("div",pt,[e[7]||(e[7]=t("label",{class:"form-label"},"Fecha",-1)),h(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>n.value.Fecha=o),type:"date",readonly:"",disabled:"",class:"form-control"},null,512),[[E,n.value.Fecha]])]),t("div",mt,[e[9]||(e[9]=t("label",{class:"form-label"},"Vendedor",-1)),h(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>n.value.Vendedor=o),class:"form-select"},[...e[8]||(e[8]=[t("option",{value:"",disabled:"",selected:""},"Seleccione",-1),t("option",{value:"Diana Benalc√°zar"},"Diana Benalc√°zar",-1)])],512),[[j,n.value.Vendedor]])]),t("div",bt,[e[11]||(e[11]=t("label",{class:"form-label"},"Tipo de documento",-1)),h(t("select",{"onUpdate:modelValue":e[4]||(e[4]=o=>n.value.Tipo=o),class:"form-select"},[...e[10]||(e[10]=[t("option",{value:"",disabled:"",selected:""},"Seleccione",-1),t("option",{value:"Pedido"},"Pedido",-1),t("option",{value:"Proforma"},"Proforma",-1)])],512),[[j,n.value.Tipo]])])])):V("",!0),e[28]||(e[28]=t("hr",{style:{border:"solid 1px silver"}},null,-1)),r.value.length?(p(),u("div",vt,[t("button",{onClick:X,class:"btn btn-warning"}," Vaciar carrito "),t("button",{class:"btn btn-primary",onClick:G,disabled:!r.value.length}," Exportar Excel ",8,ft),t("button",{class:"btn btn-success",onClick:Y,disabled:!r.value.length}," Exportar Imagen promociones ",8,gt)])):V("",!0),e[29]||(e[29]=t("hr",{style:{border:"solid 1px silver"}},null,-1)),r.value.length?(p(),u("div",xt,[w.value?(p(),u("div",ht,[...e[12]||(e[12]=[t("div",{class:"export-spinner","aria-hidden":"true"},null,-1),t("div",{class:"export-text"},"Generando archivo, por favor espere...",-1)])])):V("",!0),r.value.length?(p(),u("div",yt,[t("div",wt,[t("div",_t,[t("ul",Ct,[t("li",Pt,[e[13]||(e[13]=t("strong",null,"Subtotal 15%:",-1)),t("span",null,"$ "+i(_.value.toFixed(2)),1)]),t("li",Ft,[e[14]||(e[14]=t("strong",null,"Subtotal 0%:",-1)),t("span",null,"$ "+i(C.value.toFixed(2)),1)]),t("li",kt,[e[15]||(e[15]=t("strong",null,"IVA 15%:",-1)),t("span",null,"$ "+i(P.value.toFixed(2)),1)]),t("li",Nt,[e[16]||(e[16]=t("strong",null,"Total:",-1)),t("span",Vt,"$ "+i($.value.toFixed(2)),1)])])])])])):V("",!0),e[26]||(e[26]=t("hr",{style:{border:"solid 1px silver"}},null,-1)),D.value?(p(),u("div",Ht,[(p(!0),u(B,null,H(r.value,(o,s)=>(p(),u("div",{key:o.id,class:"card mb-3 mobile-card"},[t("div",Jt,[t("div",qt,[t("div",Wt,[t("h5",Gt,i(o.NombreProducto),1),t("div",Xt,[t("div",null,[e[18]||(e[18]=t("strong",null,"Marca:",-1)),I(" "+i(o.Marca),1)]),t("div",null,[e[19]||(e[19]=t("strong",null,"Presentaci√≥n:",-1)),I(" "+i(o.Presentacion),1)]),t("div",null,[e[20]||(e[20]=t("strong",null,"P. Activo:",-1)),I(" "+i(o.PrincipioActivo||"-"),1)])])]),t("div",Yt,[t("div",Kt," $ "+i(Number(o.PrecioFarmacia).toFixed(2)),1),t("div",Qt," IVA: "+i(o.IVA>0?o.IVA+"%":"No aplica"),1)])]),t("div",{class:nt(["promo-info p-2 mb-2 rounded",o.Promocion?"bg-light":""])},[t("div",Zt,[e[21]||(e[21]=t("strong",{class:"text-primary"},"Promoci√≥n:",-1)),t("span",te,i(o.Promocion||"Sin promoci√≥n"),1)]),o.Descuento&&Number(o.Descuento)!==0?(p(),u("div",ee,[e[22]||(e[22]=t("strong",{class:"text-primary"},"Descuento:",-1)),t("span",oe,i(o.Descuento)+"%",1)])):V("",!0)],2),t("div",ae,[t("div",se,[t("div",ne,[e[23]||(e[23]=t("label",{class:"me-2 fw-bold mb-0"},"Cantidad:",-1)),h(t("input",{type:"number",min:"0","onUpdate:modelValue":c=>o.cantidad=c,onChange:c=>M(s,o.cantidad,o.Promocion),class:"form-control",style:{width:"80px"}},null,40,le),[[E,o.cantidad,void 0,{number:!0}]])]),t("div",re,[e[24]||(e[24]=t("strong",null,"A recibir: ",-1)),t("span",de,i(J(A)(o.cantidad,o.Promocion).total),1)])])]),t("div",ie,[t("button",{class:"btn btn-outline-danger",onClick:c=>L(s)},[...e[25]||(e[25]=[t("i",{class:"fas fa-trash-alt me-2"},null,-1),I("Eliminar producto ",-1)])],8,ce)])])]))),128))])):(p(),u("div",Et,[t("table",At,[e[17]||(e[17]=t("thead",null,[t("tr",null,[t("th",{class:"text-wrap fs-6 text"},"Nombre"),t("th",{class:"text-wrap fs-6 text"},"Presentaci√≥n"),t("th",{class:"text-wrap fs-6 text"},"Principio Activo"),t("th",{class:"text-wrap fs-6 text"},"P FARMACIA"),t("th",{class:"text-wrap fs-6 text"},"Promoci√≥n"),t("th",{class:"text-wrap fs-6 text"},"Descuento"),t("th",{class:"text-wrap fs-6 text"},"Marca"),t("th",{class:"text-wrap fs-6 text"},"IVA"),t("th",{class:"text-wrap fs-6 text"},"Cantidad"),t("th",{class:"text-wrap fs-6 text"},"A recibir"),t("th",{class:"text-wrap fs-6 text"},"Acciones")])],-1)),t("tbody",null,[(p(!0),u(B,null,H(r.value,(o,s)=>(p(),u("tr",{key:o.id},[t("td",$t,i(o.NombreProducto),1),t("td",Tt,i(o.Presentacion),1),t("td",St,i(o.PrincipioActivo),1),t("td",It,"$ "+i(o.PrecioFarmacia),1),t("td",zt,i(o.Promocion),1),t("td",Rt,i(o.Descuento!==void 0&&o.Descuento!==null&&Number(o.Descuento)!==0?o.Descuento:""),1),t("td",Dt,i(o.Marca),1),t("td",Mt,i(o.IVA>0?o.IVA+"%":"No aplica"),1),t("td",Lt,[h(t("input",{type:"number",min:"0","onUpdate:modelValue":c=>o.cantidad=c,onChange:c=>M(s,o.cantidad,o.Promocion),class:"form-control form-control-sm",style:{width:"80px"}},null,40,Ot),[[E,o.cantidad,void 0,{number:!0}]])]),t("td",Ut,i(J(A)(o.cantidad,o.Promocion).total),1),t("td",jt,[t("button",{class:"btn btn-danger btn-sm",onClick:c=>L(s)}," Eliminar ",8,Bt)])]))),128))])])]))])):(p(),u("div",ue,"El carrito est√° vac√≠o."))]))}},xe=et(pe,[["__scopeId","data-v-5615b7eb"]]);export{xe as default};
