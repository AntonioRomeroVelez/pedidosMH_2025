import{_ as D,r as v,c as _,b as m,d as E,e as t,i as b,k as N,t as u,w as g,s as F,q as x,F as w,h as V,x as y}from"./index-DQ8DLb2k.js";import{r as B,u as k}from"./xlsx-hAyDQTdp.js";import{E as L}from"./exceljs.min-BN3YyU2G.js";import{F as z}from"./FileSaver.min-DlvHmWFR.js";const U={class:"container py-4"},j={class:"row g-4"},G={class:"col-md-6"},$={class:"card shadow-sm"},q={class:"card-body"},W={key:0,class:"mt-2 text-success small"},J={class:"col-md-6"},K={class:"card shadow-sm"},H={class:"card-body"},Q={key:0,class:"mt-2 text-success small"},X={class:"text-center mt-4"},Y=["disabled"],Z={key:0,class:"mt-4 text-center"},tt={key:1,class:"mt-5"},et={class:"table-responsive"},at={class:"table table-bordered table-hover align-middle"},ot={__name:"CompararExcel",setup(lt){const p=v([]),I=v([]),d=v([]),f=v(""),R=v(""),h=v("Todos");function c(s){return s?s.toString().toLowerCase().replace(/\s+/g," ").trim():""}function S(s,e){const o=s.target.files[0];if(o)try{const A=new FileReader;A.onload=C=>{const a=new Uint8Array(C.target.result),i=B(a,{type:"array"}),l=i.Sheets[i.SheetNames[0]],n=k.sheet_to_json(l,{defval:""}).map(r=>({CODIGO:r.CODIGO?.toString().trim()||"",MARCA:r.MARCA?.toString().trim()||"",NOMBRE:r.NOMBRE?.toString().trim()||"",PRESENTACION:r.PRESENTACION?.toString().trim()||"",PRINCIPIO_ACTIVO:r.PRINCIPIO_ACTIVO?.toString().trim()||"",P_FARMACIA:parseFloat(r.P_FARMACIA)||0,PVP:parseFloat(r.PVP)||0,PROMOCION:r.PROMOCION?.toString().trim()||"",DESCUENTO:r.DESCUENTO?.toString().trim()||"",IVA:r.IVA?.toString().trim()||""}));e==="base"?(p.value=n,f.value=o.name):(I.value=n,R.value=o.name)},A.readAsArrayBuffer(o)}catch{alert("丘멆잺 Error al leer el archivo. Verifica que el formato sea v치lido (.xlsx o .xls).")}}function P(){if(!p.value.length||!I.value.length){alert("丘멆잺 Debes cargar ambos archivos antes de comparar.");return}const s=[],e=new Map,o=new Set(p.value.map(a=>c(a.MARCA))),A=new Set(I.value.map(a=>c(a.MARCA))),C=new Set([...o].filter(a=>A.has(a)));for(const a of p.value){const i=[c(a.MARCA),c(a.NOMBRE),c(a.PRESENTACION),c(a.PRINCIPIO_ACTIVO)].join("|");e.set(i,{...a})}for(const a of I.value){const i=[c(a.MARCA),c(a.NOMBRE),c(a.PRESENTACION),c(a.PRINCIPIO_ACTIVO)].join("|"),l=e.get(i),O=c(a.MARCA);if(!C.has(O)){s.push({...a,ESTADO:"Nueva marca",DETALLE_CAMBIO:"Marca nueva (no exist칤a en base)"});continue}if(!l)s.push({...a,ESTADO:"Nuevo",DETALLE_CAMBIO:"Registro nuevo"});else{const n=[];a.P_FARMACIA!==l.P_FARMACIA&&n.push("P_FARMACIA"),a.PVP!==l.PVP&&n.push("PVP"),a.PROMOCION!==l.PROMOCION&&n.push("PROMOCION"),a.DESCUENTO!==l.DESCUENTO&&n.push("DESCUENTO"),a.IVA!==l.IVA&&n.push("IVA"),n.length?s.push({...a,ESTADO:"Actualizado",DETALLE_CAMBIO:`Modificado: ${n.join(", ")}`}):s.push({...a,ESTADO:"Sin cambios",DETALLE_CAMBIO:""}),e.delete(i)}}for(const a of e.values()){const i=c(a.MARCA);C.has(i)?s.push({...a,ESTADO:"Eliminado",DETALLE_CAMBIO:"Producto eliminado (no est치 en nuevo Excel)"}):s.push({...a,ESTADO:"Marca no comparada",DETALLE_CAMBIO:"Marca no est치 en el nuevo Excel"})}d.value=s.sort((a,i)=>{const l=a.MARCA.localeCompare(i.MARCA);return l!==0?l:a.NOMBRE.localeCompare(i.NOMBRE)})}const T=_(()=>h.value==="Todos"?d.value:d.value.filter(s=>s.ESTADO===h.value));async function M(){if(!d.value.length)return;const s=new L.Workbook,e=s.addWorksheet("Productos Actualizados"),o=["CODIGO","MARCA","NOMBRE","PRESENTACION","PRINCIPIO_ACTIVO","P_FARMACIA","PVP","PROMOCION","DESCUENTO","IVA","ESTADO","DETALLE_CAMBIO"];e.addRow(o),e.getRow(1).eachCell(l=>{l.font={bold:!0,color:{argb:"FFFFFFFF"}},l.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF1F4E78"}},l.alignment={vertical:"middle",horizontal:"center"}});for(const l of d.value){const O=e.addRow(Object.values(l));let n="FFFFFFFF";l.ESTADO==="Nuevo"?n="FFB7E1CD":l.ESTADO==="Actualizado"?n="FFFFF3CD":l.ESTADO==="Eliminado"&&(n="FFF8D7DA"),O.eachCell(r=>{r.fill={type:"pattern",pattern:"solid",fgColor:{argb:n}}})}e.columns.forEach(l=>{let O=10;l.eachCell({includeEmpty:!0},n=>{const r=n.value?n.value.toString().length:10;r>O&&(O=r)}),l.width=O+2});const C=new Date().toISOString().split("T")[0],a=f.value?f.value.replace(/\.xlsx$/i,`_Actualizado_${C}.xlsx`):`Productos_Actualizados_${C}.xlsx`,i=await s.xlsx.writeBuffer();z.saveAs(new Blob([i]),a)}return(s,e)=>(E(),m("div",U,[e[13]||(e[13]=t("h2",{class:"text-center mb-4"},"游늵 Comparador de Archivos Excel",-1)),t("div",j,[t("div",G,[t("div",$,[t("div",q,[e[4]||(e[4]=t("h5",{class:"card-title"},"游닂 Archivo base (anterior)",-1)),t("input",{type:"file",accept:".xlsx,.xls",class:"form-control",onChange:e[0]||(e[0]=o=>S(o,"base"))},null,32),f.value?(E(),m("div",W,[e[3]||(e[3]=t("i",{class:"bi bi-file-earmark-excel"},null,-1)),N(" "+u(f.value),1)])):b("",!0)])])]),t("div",J,[t("div",K,[t("div",H,[e[6]||(e[6]=t("h5",{class:"card-title"},"游닁 Archivo nuevo",-1)),t("input",{type:"file",accept:".xlsx,.xls",class:"form-control",onChange:e[1]||(e[1]=o=>S(o,"nuevo"))},null,32),R.value?(E(),m("div",Q,[e[5]||(e[5]=t("i",{class:"bi bi-file-earmark-excel"},null,-1)),N(" "+u(R.value),1)])):b("",!0)])])])]),t("div",X,[t("button",{class:"btn btn-primary px-4 me-2",disabled:!p.value.length||!I.value.length,onClick:P},[...e[7]||(e[7]=[t("i",{class:"bi bi-arrow-repeat"},null,-1),N(" Comparar archivos ",-1)])],8,Y),d.value.length?(E(),m("button",{key:0,class:"btn btn-success px-4",onClick:M},[...e[8]||(e[8]=[t("i",{class:"bi bi-file-earmark-arrow-down"},null,-1),N(" Descargar plantilla actualizada ",-1)])])):b("",!0)]),d.value.length?(E(),m("div",Z,[e[10]||(e[10]=t("label",{class:"fw-bold me-2"},"Filtrar por estado:",-1)),g(t("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>h.value=o),class:"form-select d-inline-block w-auto"},[...e[9]||(e[9]=[x('<option value="Todos" data-v-3a8b0100>Todos</option><option value="Nuevo" data-v-3a8b0100>Nuevos</option><option value="Actualizado" data-v-3a8b0100>Actualizados</option><option value="Eliminado" data-v-3a8b0100>Eliminados</option><option value="Sin cambios" data-v-3a8b0100>Sin cambios</option>',5)])],512),[[F,h.value]])])):b("",!0),d.value.length?(E(),m("div",tt,[e[12]||(e[12]=t("h4",{class:"mb-3"},"Resultado de la comparaci칩n",-1)),t("div",et,[t("table",at,[e[11]||(e[11]=t("thead",{class:"table-light"},[t("tr",null,[t("th",null,"CODIGO"),t("th",null,"MARCA"),t("th",null,"NOMBRE"),t("th",null,"PRESENTACION"),t("th",null,"PRINCIPIO_ACTIVO"),t("th",null,"P_FARMACIA"),t("th",null,"PVP"),t("th",null,"PROMOCION"),t("th",null,"DESCUENTO"),t("th",null,"IVA"),t("th",null,"ESTADO"),t("th",null,"DETALLE_CAMBIO")])],-1)),t("tbody",null,[(E(!0),m(w,null,V(T.value,(o,A)=>(E(),m("tr",{key:A,class:y({"table-success":o.ESTADO==="Nuevo","table-warning":o.ESTADO==="Actualizado","table-danger":o.ESTADO==="Eliminado"})},[t("td",null,u(o.CODIGO),1),t("td",null,u(o.MARCA),1),t("td",null,u(o.NOMBRE),1),t("td",null,u(o.PRESENTACION),1),t("td",null,u(o.PRINCIPIO_ACTIVO),1),t("td",null,u(o.P_FARMACIA),1),t("td",null,u(o.PVP),1),t("td",null,u(o.PROMOCION),1),t("td",null,u(o.DESCUENTO),1),t("td",null,u(o.IVA),1),t("td",null,[t("strong",null,u(o.ESTADO),1)]),t("td",null,u(o.DETALLE_CAMBIO),1)],2))),128))])])])])):b("",!0)]))}},ut=D(ot,[["__scopeId","data-v-3a8b0100"]]);export{ut as default};
