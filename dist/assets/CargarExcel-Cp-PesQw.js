import{_ as j,m as B,n as $,r as u,o as z,c as G,a as U,b as n,d as c,q as J,e,j as v,g,t as a,h as E,k as W,w as q,s as H,F as K,i as Q,x as X}from"./index-BlbSX9Q7.js";import{r as Y,u as Z}from"./xlsx-hAyDQTdp.js";import{E as ee}from"./exceljs.min-DrSv91ol.js";import{F as te}from"./FileSaver.min-BnaOKr_x.js";import{L as oe}from"./LoadingComponent-D4trAxUb.js";const ae={class:"cargar-excel container",style:{"margin-top":"60px"}},re={class:"mb-4"},se={class:"input-group"},le={key:0,class:"form-text text-success mt-2"},ie={key:0,class:"alert alert-info"},de={class:"mb-0"},ne={class:"mb-4"},ce={key:1},ue={key:2},pe={key:0,class:"mb-3 text-end"},me={key:1,class:"vista-previa mt-4"},ve={class:"table-responsive shadow-sm rounded-4 border position-relative",style:{"max-height":"70vh","overflow-y":"auto"}},he={class:"table table-hover align-middle text-center table-striped",style:{"min-width":"950px","word-wrap":"break-word","table-layout":"fixed"}},be={class:"text-break"},ge={class:"text-break"},xe={class:"text-break"},fe={class:"text-break"},ye={class:"text-break"},Pe={class:"text-break"},we={__name:"CargarExcel",setup(_e){const p=B(),A=$(),x=u(!1),r=u([]),I=u([]),m=u([]),_=u(""),R=u(0),f=u(!1),y=u("todos");z(()=>{const s=localStorage.getItem("ListaProductos");s&&(r.value=JSON.parse(s))});const V=G(()=>y.value==="repetidos"?r.value.filter(s=>s.duplicado):y.value==="noRepetidos"?r.value.filter(s=>!s.duplicado):r.value),O=s=>{x.value=!0;const t=s.target.files[0];if(!t){x.value=!1;return}_.value=t.name;const h=new FileReader;h.onload=o=>{try{const l=new Uint8Array(o.target.result),C=Y(l,{type:"array"});I.value=[],m.value=[],f.value=!1;let P=[];C.SheetNames.forEach(i=>{const b=C.Sheets[i];Z.sheet_to_json(b).forEach(S=>{const d={};Object.keys(S).forEach(N=>{const L=N.normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim().toUpperCase();d[L]=S[N]});const F=d.CODIGO?.toString().trim()||"",T={ID:F||`id-${Math.random().toString(36).substr(2,5)}`,Codigo:F,Marca:d.MARCA?.toString().trim()||"",NombreProducto:d.NOMBRE?.toString().trim()||"",Presentacion:d.PRESENTACION?.toString().trim()||"",PrincipioActivo:d.PRINCIPIO_ACTIVO?.toString().trim()||"",PrecioFarmacia:parseFloat((d.P_FARMACIA||"0").toString().replace(",","."))||0,PVP:parseFloat((d.PVP||"0").toString().replace(",","."))||0,Promocion:d.PROMOCION||"",Descuento:parseFloat((d.DESCUENTO||"0").toString())||0,IVA:parseFloat((d.IVA||"0").toString().replace(",","."))||0,duplicado:!1};P.push(T)})});const w=i=>(i||"").toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"").toLowerCase(),k=new Map;P.forEach(i=>{const b=`${w(i.Marca)}|${w(i.NombreProducto)}|${w(i.Presentacion)}|${w(i.PrincipioActivo)}`;k.has(b)?(i.duplicado=!0,k.get(b).duplicado=!0,f.value=!0):k.set(b,i)}),r.value=P,m.value=P.filter(i=>i.duplicado),f.value?p.error("‚ö†Ô∏è Se detectaron productos duplicados en el archivo. Revisa los resaltados en rojo."):p.success("‚úÖ Archivo cargado correctamente, sin duplicados internos.")}catch(l){p.error("‚ùå Error al procesar el archivo."),console.error("Error al leer Excel:",l)}finally{x.value=!1}},h.readAsArrayBuffer(t)},D=()=>{if(f.value){p.error("‚ùå No se puede guardar. Elimina los productos duplicados.");return}localStorage.setItem("ListaProductos",JSON.stringify(r.value)),p.success(`‚úÖ Se guardaron ${r.value.length} productos correctamente.`),setTimeout(()=>{A.push("/Productos")},1e3)};async function M(){if(!m.value.length){p.info("No hay productos repetidos para exportar");return}const s=new ee.Workbook,t=s.addWorksheet("Productos Repetidos");t.columns=[{header:"CODIGO",key:"Codigo",width:15},{header:"Marca",key:"Marca",width:20},{header:"NombreProducto",key:"NombreProducto",width:40},{header:"Presentacion",key:"Presentacion",width:25},{header:"PrincipioActivo",key:"PrincipioActivo",width:30}],m.value.forEach(l=>t.addRow(l)),t.getRow(1).eachCell(l=>{l.font={bold:!0,color:{argb:"FFFFFFFF"}},l.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFB91D1D"}},l.alignment={vertical:"middle",horizontal:"center"}});const o=await s.xlsx.writeBuffer();te.saveAs(new Blob([o]),"productos_repetidos.xlsx"),p.success("üì¶ Archivo de productos repetidos exportado correctamente")}return(s,t)=>{const h=U("RouterLink");return c(),n("div",ae,[t[12]||(t[12]=J('<h2 data-v-02ab6e8e>üì• Cargar productos desde Excel</h2><p data-v-02ab6e8e>üìù El archivo debe tener las siguientes columnas:</p><div class="table-responsive container" data-v-02ab6e8e><table class="table table-bordered formato-tabla" data-v-02ab6e8e><thead data-v-02ab6e8e><tr data-v-02ab6e8e><th data-v-02ab6e8e>CODIGO</th><th data-v-02ab6e8e>Marca</th><th data-v-02ab6e8e>Nombre</th><th data-v-02ab6e8e>Presentacion</th><th data-v-02ab6e8e>Principio_Activo</th><th data-v-02ab6e8e>P_Farmacia</th><th data-v-02ab6e8e>PVP</th><th data-v-02ab6e8e>Promocion</th><th data-v-02ab6e8e>Descuento</th><th data-v-02ab6e8e>IVA</th></tr></thead><tbody data-v-02ab6e8e><tr data-v-02ab6e8e><td data-v-02ab6e8e>2343</td><td data-v-02ab6e8e>Genfar</td><td data-v-02ab6e8e>Paracetamol 500mg</td><td data-v-02ab6e8e>Caja x 10</td><td data-v-02ab6e8e>Paracetamol</td><td data-v-02ab6e8e>1.50</td><td data-v-02ab6e8e>2.00</td><td data-v-02ab6e8e>2x1</td><td data-v-02ab6e8e>10</td><td data-v-02ab6e8e>15</td></tr></tbody></table></div>',3)),e("div",re,[t[2]||(t[2]=e("label",{for:"excelInput",class:"form-label fw-semibold text-primary"}," üìÑ Cargar archivo Excel ",-1)),e("div",se,[t[1]||(t[1]=e("label",{class:"input-group-text bg-success text-white",for:"excelInput",style:{cursor:"pointer"}},[e("i",{class:"bi bi-arrow-bar-up me-2"}),g(" Subir Excel ")],-1)),e("input",{type:"file",class:"form-control",id:"excelInput",onChange:O,accept:".xlsx, .xls"},null,32)]),_.value?(c(),n("div",le," Archivo seleccionado: "+a(_.value),1)):v("",!0)]),r.value.length||m.value.length?(c(),n("div",ie,[t[6]||(t[6]=e("strong",null,"üìä Resumen:",-1)),e("ul",de,[e("li",null,[t[3]||(t[3]=g(" üü¢ Nuevos productos cargados: ",-1)),e("b",null,a(R.value),1)]),e("li",null,[t[4]||(t[4]=g(" üü° Productos repetidos detectados: ",-1)),e("b",null,a(m.value.length),1)]),e("li",null,[t[5]||(t[5]=g(" üì¶ Total actual en memoria: ",-1)),e("b",null,a(r.value.length),1)])])])):v("",!0),e("div",ne,[r.value.length?(c(),n("button",{key:0,onClick:D,class:"btn btn-success m-2"}," üíæ Guardar productos en memoria ")):v("",!0),m.value.length?(c(),n("button",{key:1,onClick:M,class:"btn btn-danger m-2"}," üì§ Exportar productos repetidos ")):v("",!0),E(h,{class:"btn btn-warning px-2 sm m-2",to:"/Productos"},{default:W(()=>[...t[7]||(t[7]=[g(" Cancelar ",-1)])]),_:1})]),x.value?(c(),n("div",ce,[E(oe)])):(c(),n("div",ue,[r.value.length?(c(),n("div",pe,[t[9]||(t[9]=e("label",{class:"me-2 fw-semibold text-primary"},"üîç Mostrar:",-1)),q(e("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>y.value=o),class:"form-select d-inline w-auto"},[...t[8]||(t[8]=[e("option",{value:"todos"},"Todos",-1),e("option",{value:"repetidos"},"Solo repetidos",-1),e("option",{value:"noRepetidos"},"Solo no repetidos",-1)])],512),[[H,y.value]])])):v("",!0),r.value.length?(c(),n("div",me,[t[11]||(t[11]=e("h4",{class:"fw-bold text-primary mb-3 text-center text-md-start"}," üëÄ Vista previa de productos cargados ",-1)),e("div",ve,[e("table",he,[t[10]||(t[10]=e("thead",{class:"table-primary sticky-header"},[e("tr",null,[e("th",{scope:"col",style:{"min-width":"40px"}},"C√≥digo"),e("th",{scope:"col",style:{width:"20px"}},"#"),e("th",{scope:"col",style:{"min-width":"140px"}},"Marca"),e("th",{scope:"col",style:{"min-width":"200px"}},"Nombre Producto"),e("th",{scope:"col",style:{"min-width":"140px"}},"Presentaci√≥n"),e("th",{scope:"col",style:{"min-width":"160px"}},"Principio Activo"),e("th",{scope:"col",style:{"min-width":"100px"}},"P. Farmacia"),e("th",{scope:"col",style:{"min-width":"90px"}},"PVP"),e("th",{scope:"col",style:{"min-width":"120px"}},"Promoci√≥n"),e("th",{scope:"col",style:{"min-width":"120px"}},"Descuento"),e("th",{scope:"col",style:{"min-width":"70px"}},"IVA")])],-1)),e("tbody",null,[(c(!0),n(K,null,Q(V.value,(o,l)=>(c(),n("tr",{key:l,class:X({"table-danger":o.duplicado})},[e("td",be,a(o.Codigo),1),e("td",null,a(l+1),1),e("td",ge,a(o.Marca),1),e("td",xe,a(o.NombreProducto),1),e("td",fe,a(o.Presentacion),1),e("td",ye,a(o.PrincipioActivo),1),e("td",null,a(o.PrecioFarmacia.toFixed(2)),1),e("td",null,a(o.PVP.toFixed(2)),1),e("td",Pe,a(o.Promocion),1),e("td",null,a(o.Descuento),1),e("td",null,a(o.IVA),1)],2))),128))])])])])):v("",!0)]))])}}},Ae=j(we,[["__scopeId","data-v-02ab6e8e"]]);export{Ae as default};
