import{_ as g,r as v,c as D,b as O,d as E,e as t,j as h,g as b,t as u,w as _,y as F,q as x,F as w,i as y,s as V}from"./index-D6b8pbq9.js";import{r as B,u as k}from"./xlsx-hAyDQTdp.js";import{E as L}from"./exceljs.min-NTn1rZK0.js";import{F as z}from"./FileSaver.min-CcFAjtan.js";const U={class:"container py-4",style:{"margin-top":"80px"}},j={class:"row g-4"},G={class:"col-md-6"},$={class:"card shadow-sm"},q={class:"card-body"},W={key:0,class:"mt-2 text-success small"},J={class:"col-md-6"},K={class:"card shadow-sm"},H={class:"card-body"},Q={key:0,class:"mt-2 text-success small"},X={class:"text-center mt-4"},Y=["disabled"],Z={key:0,class:"mt-4 text-center"},tt={key:1,class:"mt-5"},et={class:"table-responsive"},ot={class:"table table-bordered table-hover align-middle"},at={__name:"CompararExcel",setup(lt){const p=v([]),I=v([]),d=v([]),f=v(""),R=v(""),N=v("Todos");function c(s){return s?s.toString().toLowerCase().replace(/\s+/g," ").trim():""}function S(s,e){const a=s.target.files[0];if(a)try{const A=new FileReader;A.onload=C=>{const o=new Uint8Array(C.target.result),i=B(o,{type:"array"}),l=i.Sheets[i.SheetNames[0]],n=k.sheet_to_json(l,{defval:""}).map(r=>({CODIGO:r.CODIGO?.toString().trim()||"",MARCA:r.MARCA?.toString().trim()||"",NOMBRE:r.NOMBRE?.toString().trim()||"",PRESENTACION:r.PRESENTACION?.toString().trim()||"",PRINCIPIO_ACTIVO:r.PRINCIPIO_ACTIVO?.toString().trim()||"",P_FARMACIA:parseFloat(r.P_FARMACIA)||0,PVP:parseFloat(r.PVP)||0,PROMOCION:r.PROMOCION?.toString().trim()||"",DESCUENTO:r.DESCUENTO?.toString().trim()||"",IVA:r.IVA?.toString().trim()||""}));e==="base"?(p.value=n,f.value=a.name):(I.value=n,R.value=a.name)},A.readAsArrayBuffer(a)}catch{alert("丘멆잺 Error al leer el archivo. Verifica que el formato sea v치lido (.xlsx o .xls).")}}function P(){if(!p.value.length||!I.value.length){alert("丘멆잺 Debes cargar ambos archivos antes de comparar.");return}const s=[],e=new Map,a=new Set(p.value.map(o=>c(o.MARCA))),A=new Set(I.value.map(o=>c(o.MARCA))),C=new Set([...a].filter(o=>A.has(o)));for(const o of p.value){const i=[c(o.MARCA),c(o.NOMBRE),c(o.PRESENTACION),c(o.PRINCIPIO_ACTIVO)].join("|");e.set(i,{...o})}for(const o of I.value){const i=[c(o.MARCA),c(o.NOMBRE),c(o.PRESENTACION),c(o.PRINCIPIO_ACTIVO)].join("|"),l=e.get(i),m=c(o.MARCA);if(!C.has(m)){s.push({...o,ESTADO:"Nueva marca",DETALLE_CAMBIO:"Marca nueva (no exist칤a en base)"});continue}if(!l)s.push({...o,ESTADO:"Nuevo",DETALLE_CAMBIO:"Registro nuevo"});else{const n=[];o.P_FARMACIA!==l.P_FARMACIA&&n.push("P_FARMACIA"),o.PVP!==l.PVP&&n.push("PVP"),o.PROMOCION!==l.PROMOCION&&n.push("PROMOCION"),o.DESCUENTO!==l.DESCUENTO&&n.push("DESCUENTO"),o.IVA!==l.IVA&&n.push("IVA"),n.length?s.push({...o,ESTADO:"Actualizado",DETALLE_CAMBIO:`Modificado: ${n.join(", ")}`}):s.push({...o,ESTADO:"Sin cambios",DETALLE_CAMBIO:""}),e.delete(i)}}for(const o of e.values()){const i=c(o.MARCA);C.has(i)?s.push({...o,ESTADO:"Eliminado",DETALLE_CAMBIO:"Producto eliminado (no est치 en nuevo Excel)"}):s.push({...o,ESTADO:"Marca no comparada",DETALLE_CAMBIO:"Marca no est치 en el nuevo Excel"})}d.value=s.sort((o,i)=>{const l=o.MARCA.localeCompare(i.MARCA);return l!==0?l:o.NOMBRE.localeCompare(i.NOMBRE)})}const T=D(()=>N.value==="Todos"?d.value:d.value.filter(s=>s.ESTADO===N.value));async function M(){if(!d.value.length)return;const s=new L.Workbook,e=s.addWorksheet("Productos Actualizados"),a=["CODIGO","MARCA","NOMBRE","PRESENTACION","PRINCIPIO_ACTIVO","P_FARMACIA","PVP","PROMOCION","DESCUENTO","IVA","ESTADO","DETALLE_CAMBIO"];e.addRow(a),e.getRow(1).eachCell(l=>{l.font={bold:!0,color:{argb:"FFFFFFFF"}},l.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF1F4E78"}},l.alignment={vertical:"middle",horizontal:"center"}});for(const l of d.value){const m=e.addRow(Object.values(l));let n="FFFFFFFF";l.ESTADO==="Nuevo"?n="FFB7E1CD":l.ESTADO==="Actualizado"?n="FFFFF3CD":l.ESTADO==="Eliminado"&&(n="FFF8D7DA"),m.eachCell(r=>{r.fill={type:"pattern",pattern:"solid",fgColor:{argb:n}}})}e.columns.forEach(l=>{let m=10;l.eachCell({includeEmpty:!0},n=>{const r=n.value?n.value.toString().length:10;r>m&&(m=r)}),l.width=m+2});const C=new Date().toISOString().split("T")[0],o=f.value?f.value.replace(/\.xlsx$/i,`_Actualizado_${C}.xlsx`):`Productos_Actualizados_${C}.xlsx`,i=await s.xlsx.writeBuffer();z.saveAs(new Blob([i]),o)}return(s,e)=>(E(),O("div",U,[e[13]||(e[13]=t("h2",{class:"text-center mb-4"},"游늵 Comparador de Archivos Excel",-1)),t("div",j,[t("div",G,[t("div",$,[t("div",q,[e[4]||(e[4]=t("h5",{class:"card-title"},"游닂 Archivo base (anterior)",-1)),t("input",{type:"file",accept:".xlsx,.xls",class:"form-control",onChange:e[0]||(e[0]=a=>S(a,"base"))},null,32),f.value?(E(),O("div",W,[e[3]||(e[3]=t("i",{class:"bi bi-file-earmark-excel"},null,-1)),b(" "+u(f.value),1)])):h("",!0)])])]),t("div",J,[t("div",K,[t("div",H,[e[6]||(e[6]=t("h5",{class:"card-title"},"游닁 Archivo nuevo",-1)),t("input",{type:"file",accept:".xlsx,.xls",class:"form-control",onChange:e[1]||(e[1]=a=>S(a,"nuevo"))},null,32),R.value?(E(),O("div",Q,[e[5]||(e[5]=t("i",{class:"bi bi-file-earmark-excel"},null,-1)),b(" "+u(R.value),1)])):h("",!0)])])])]),t("div",X,[t("button",{class:"btn btn-primary px-4 me-2",disabled:!p.value.length||!I.value.length,onClick:P},[...e[7]||(e[7]=[t("i",{class:"bi bi-arrow-repeat"},null,-1),b(" Comparar archivos ",-1)])],8,Y),d.value.length?(E(),O("button",{key:0,class:"btn btn-success px-4",onClick:M},[...e[8]||(e[8]=[t("i",{class:"bi bi-file-earmark-arrow-down"},null,-1),b(" Descargar plantilla actualizada ",-1)])])):h("",!0)]),d.value.length?(E(),O("div",Z,[e[10]||(e[10]=t("label",{class:"fw-bold me-2"},"Filtrar por estado:",-1)),_(t("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>N.value=a),class:"form-select d-inline-block w-auto"},[...e[9]||(e[9]=[x('<option value="Todos" data-v-592472c1>Todos</option><option value="Nuevo" data-v-592472c1>Nuevos</option><option value="Actualizado" data-v-592472c1>Actualizados</option><option value="Eliminado" data-v-592472c1>Eliminados</option><option value="Sin cambios" data-v-592472c1>Sin cambios</option>',5)])],512),[[F,N.value]])])):h("",!0),d.value.length?(E(),O("div",tt,[e[12]||(e[12]=t("h4",{class:"mb-3"},"Resultado de la comparaci칩n",-1)),t("div",et,[t("table",ot,[e[11]||(e[11]=t("thead",{class:"table-light"},[t("tr",null,[t("th",null,"CODIGO"),t("th",null,"MARCA"),t("th",null,"NOMBRE"),t("th",null,"PRESENTACION"),t("th",null,"PRINCIPIO_ACTIVO"),t("th",null,"P_FARMACIA"),t("th",null,"PVP"),t("th",null,"PROMOCION"),t("th",null,"DESCUENTO"),t("th",null,"IVA"),t("th",null,"ESTADO"),t("th",null,"DETALLE_CAMBIO")])],-1)),t("tbody",null,[(E(!0),O(w,null,y(T.value,(a,A)=>(E(),O("tr",{key:A,class:V({"table-success":a.ESTADO==="Nuevo","table-warning":a.ESTADO==="Actualizado","table-danger":a.ESTADO==="Eliminado"})},[t("td",null,u(a.CODIGO),1),t("td",null,u(a.MARCA),1),t("td",null,u(a.NOMBRE),1),t("td",null,u(a.PRESENTACION),1),t("td",null,u(a.PRINCIPIO_ACTIVO),1),t("td",null,u(a.P_FARMACIA),1),t("td",null,u(a.PVP),1),t("td",null,u(a.PROMOCION),1),t("td",null,u(a.DESCUENTO),1),t("td",null,u(a.IVA),1),t("td",null,[t("strong",null,u(a.ESTADO),1)]),t("td",null,u(a.DETALLE_CAMBIO),1)],2))),128))])])])])):h("",!0)]))}},ut=g(at,[["__scopeId","data-v-592472c1"]]);export{ut as default};
